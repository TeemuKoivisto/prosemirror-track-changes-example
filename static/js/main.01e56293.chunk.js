(this["webpackJsonpprosemirror-track-changes-example"]=this["webpackJsonpprosemirror-track-changes-example"]||[]).push([[0],{233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){},236:function(e,t,n){},237:function(e,t,n){"use strict";n.r(t);var r,c,i,a,o,s,l=n(0),u=n(19),d=n(49),b=n(7),h=n(5),j=n(80),g=n(10),f=n(6),m=n(3),p=function(e){var t=e.className;return Object(m.jsx)(O,{className:t,children:Object(m.jsx)(v,{children:Object(m.jsx)(x,{to:"/",exact:!0,activeClassName:"current",children:"Front page"})})})},O=f.a.div(r||(r=Object(h.a)(["\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n"]))),v=f.a.nav(c||(c=Object(h.a)(["\n  align-items: center;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n"]))),x=Object(f.a)(d.b)(i||(i=Object(h.a)(["\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n"]))),w=["component"],y=function(e){var t,n=e.component,r=Object(j.a)(e,w);return Object(m.jsx)(b.b,Object(g.a)(Object(g.a)({},r),{},{render:(t=n,function(e){return Object(m.jsxs)(k,{children:[Object(m.jsx)(p,Object(g.a)({},e)),Object(m.jsx)(S,{children:Object(m.jsx)(t,Object(g.a)({},e))})]})})}))},k=f.a.div(a||(a=Object(h.a)(["\n  min-height: 100vh;\n"]))),S=f.a.main(o||(o=Object(h.a)(["\n  margin: 40px auto 0 auto;\n  max-width: 800px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n"])));function D(e){var t=e.className;return Object(m.jsx)(N,{className:t,children:Object(m.jsxs)("header",{children:[Object(m.jsx)("h1",{children:Object(m.jsx)("a",{href:"https://teemukoivisto.github.io/prosemirror-track-changes-example/",children:"Track changes example"})}),Object(m.jsx)("p",{children:"With prosemirror-changeset"}),Object(m.jsx)("p",{children:Object(m.jsx)("a",{href:"https://github.com/TeemuKoivisto/prosemirror-track-changes-example",children:"Github repo"})})]})})}var A,M,N=f.a.div(s||(s=Object(h.a)(["\n"]))),C=n(101),E=n.n(C),B=n(108),_=n(30),I=n(51),R=n(107),z=function(){function e(){Object(I.a)(this,e),this._view=void 0}return Object(R.a)(e,[{key:"init",value:function(e){this._view=e}},{key:"view",get:function(){if(!this._view)throw Error("EditorViewProvider editorView accessed without editorView instance");return this._view}},{key:"execCommand",value:function(e){e(this.view.state,this.view.dispatch)}}]),e}(),P=function(){return{viewProvider:new z}},J=Object(l.createContext)(P()),V=function(){return Object(l.useContext)(J)};function W(e){var t=e.className,n=Object(l.useState)("1"),r=Object(_.a)(n,2),c=r[0],i=r[1],a=V().viewProvider;function o(e){var t=a.view;t.dispatch(t.state.tr.setMeta("set-userID",e)),i(e)}return Object(m.jsxs)(K,{className:t,children:[Object(m.jsxs)("div",{className:"current-user",children:["Current user: ",c]}),Object(m.jsxs)("div",{children:[Object(m.jsx)(q,{onClick:function(){return o("1")},children:"User 1"}),Object(m.jsx)(q,{onClick:function(){return o("2")},children:"User 2"}),Object(m.jsx)(q,{onClick:function(){return o("3")},children:"User 3"})]})]})}var K=f.a.div(A||(A=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  .current-user {\n    margin: 0.25rem 1rem 0.25rem 0;\n  }\n"]))),q=f.a.button(M||(M=Object(h.a)(["\n  cursor: pointer;\n  & + & {\n    margin-left: 0.5rem;\n  }\n"]))),T=n(38),U=n(2),F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.state,c=n?r.plugins.filter((function(e){return e!==t})):[].concat(Object(T.a)(r.plugins),[t]);r=r.reconfigure({plugins:c}),e.updateState(r)};function G(e){var t=V().viewProvider,n=Object(l.useState)(t._view?e.getState(t._view.state):null),r=Object(_.a)(n,2),c=r[0],i=r[1];return Object(l.useEffect)((function(){var n=t._view;if(n){var r=function(e,t){return new U.d({key:new U.e("withPluginState_".concat(e.key)),view:function(){return{update:function(n,r){var c=n.state;if(r!==c){var i=e.getState(c);i!==e.getState(r)&&t(i)}}}}})}(e,i);return F(n,r),function(){F(n,r,!0)}}}),[t._view,e]),c}var L,$,H,Q,X,Y,Z,ee,te,ne,re,ce=n(16),ie=n(52),ae=n(241),oe=n(53);function se(e){var t=e.change,n=e.comments,r=e.onClose,c=e.onAccept,i=e.onReject,a=(e.onSubmitReply,Object(l.useState)("")),o=Object(_.a)(a,2),s=o[0],u=o[1];return Object(m.jsxs)(je,{children:[Object(m.jsx)(me,{children:Object(m.jsx)(pe,{onClick:function(){return r()},children:Object(m.jsx)(oe.b,{size:14})})}),Object(m.jsxs)(ge,{children:[Object(m.jsxs)(fe,{children:[Object(m.jsxs)(Oe,{children:[Object(m.jsx)(ve,{children:t.author.name}),Object(m.jsx)(xe,{children:t.timeStr})]}),t.inserted&&Object(m.jsxs)("div",{children:['inserted: "',t.inserted,'"']}),t.deleted&&Object(m.jsxs)("div",{children:['deleted: "',t.deleted,'"']})]}),n.map((function(e){return Object(m.jsxs)(fe,{children:[Object(m.jsxs)(Oe,{children:[Object(m.jsx)(ve,{children:e.user.name}),Object(m.jsx)(xe,{children:e.timeStr})]}),Object(m.jsx)("div",{children:e.text})]},e.id)}))]}),Object(m.jsx)(we,{placeholder:"Reply...",value:s,onChange:function(e){return u(e.target.value)}}),Object(m.jsxs)(ye,{children:[Object(m.jsx)(ke,{className:"accept",onClick:function(){return c()},children:Object(m.jsx)(oe.a,{size:14})}),Object(m.jsx)(ke,{className:"reject",onClick:function(){return i()},children:Object(m.jsx)(oe.b,{size:14})})]})]})}var le,ue,de,be,he,je=f.a.div(L||(L=Object(h.a)(["\n  background: #333;\n  color: white;\n  padding: 1rem;\n  position: relative;\n  font-size: 13px;\n  border-radius: 4px;\n"]))),ge=f.a.ul($||($=Object(h.a)(["\n  list-style: none;\n  margin: 0;\n  padding: 0;\n"]))),fe=f.a.li(H||(H=Object(h.a)(["\n  & > div {\n    display: flex;\n    margin-bottom: 0.25rem;\n  }\n"]))),me=f.a.div(Q||(Q=Object(h.a)(["\n  position: absolute;\n  right: -6px;\n  top: -6px;\n"]))),pe=f.a.button(X||(X=Object(h.a)(["\n  align-items: center;\n  background: #333;\n  border: 0;\n  border-radius: 100%;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  padding: 0.25rem;\n"]))),Oe=f.a.div(Y||(Y=Object(h.a)(["\n  display: flex;\n"]))),ve=f.a.div(Z||(Z=Object(h.a)(["\n  margin-right: 1rem;\n"]))),xe=f.a.time(ee||(ee=Object(h.a)([""]))),we=f.a.input(te||(te=Object(h.a)(["\n  background: #e4e4e4;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  height: 1rem;\n  margin-top: 0.5rem;\n  padding: 0.75rem 0.5rem;\n  width: 100%;\n"]))),ye=f.a.div(ne||(ne=Object(h.a)(["\n  display: flex;\n  margin-top: 1rem;\n  & > button + button {\n    margin-left: 1rem;\n  }\n"]))),ke=f.a.button(re||(re=Object(h.a)(["\n  align-items: center;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  cursor: pointer;\n  display: flex;\n  padding: 0.25rem 0.75rem;\n  justify-content: center;\n  &.accept {\n    background: #16d816;\n  }\n  &.reject {\n    background: #ff3c3c;\n  }\n"]))),Se=new U.e("track-changes"),De=[["greenyellow","#ffa4a4"],["#10c727","#ff0707"],["#7adcb8","#f93aa2"]],Ae=function(){var e,t,n=document.createElement("div");return n.id="track-changes-comment-pop-up",null===(e=document.querySelector("body"))||void 0===e||e.appendChild(n),new U.d({key:Se,state:{init:function(e,t){return{changeSet:ie.b.create(t.doc),decorationSet:ce.b.empty,userColors:new Map,userID:"1"}},apply:function(e,t,n,r){if(e.getMeta("set-userID"))return Object(g.a)(Object(g.a)({},t),{},{userID:e.getMeta("set-userID")});var c,i=t.changeSet,a=t.userColors,o=t.userID,s=Number(e.getMeta("accept-change"));if(Number.isNaN(s))c=i.addSteps(e.doc,e.mapping.maps,{userID:o});else{var l=i.changes[s],u=n.doc.slice(l.fromB,l.toB),d=U.b.create({schema:n.schema,doc:i.startDoc});d=d.apply(d.tr.replaceWith(l.fromA,l.toA,u.content));var b=i.changes.slice(0,s),h=i.changes.slice(s+1).map((function(e){var t=e.fromA-l.lenA+u.content.size,n=e.toA-l.lenA+u.content.size;return new ie.a(t,n,e.fromB,e.toB,e.deleted,e.inserted)})),j=[].concat(Object(T.a)(b),Object(T.a)(h));c=new ie.b(Object(g.a)(Object(g.a)({},i.config),{},{doc:d.doc}),j)}a.has(o)||a.set(o,De[a.size]);var f=[],m=0,p=0;return c.changes.forEach((function(e,r){var i=e.fromB,a=e.inserted,o=e.deleted,s=e.deleted.length>0?e.inserted.length>0?"insert+delete":"delete":"insert";a.forEach((function(n){var c=t.userColors.get(n.data.userID),a="background: ".concat(c?c[0]:"",";");f.push(ce.a.inline(i,e.toB,{style:a,"data-change-type":s,"data-change-index":r.toString()})),i+=n.length,p+=n.length}));var l=0;o.forEach((function(i){var a=e.fromA+l,o=c.startDoc.textBetween(a,a+i.length),u=t.userColors.get(i.data.userID),d={style:"background: ".concat(u?u[1]:"",";"),"data-change-type":s,"data-change-index":r.toString()};f.push(ce.a.widget(a+m+p,function(e,t){return function(n,r){var c=document.createElement("span");return c.textContent=e,Object.keys(t).forEach((function(e){c.setAttribute(e,t[e])})),c}}(o,d),{side:0,marks:[n.schema.marks.strikethrough.create()]})),m-=i.length,l+=i.length}))})),{changeSet:c,decorationSet:ce.b.create(e.doc,f),userColors:a,userID:o}}},props:{decorations:function(e){return this.getState(e).decorationSet},handleClickOn:function(e,r,c,i,a,o){var s=a.target?a.target:void 0,l=null===s||void 0===s?void 0:s.getAttribute("data-change-index"),d=null===s||void 0===s?void 0:s.getAttribute("data-change-type");if(s&&l&&d){var b=this.getState(e.state).changeSet,h=Number(l),j=b.changes[h],f=d,p="insert"===f||"insert+delete"===f?e.state.doc.textBetween(j.fromB,j.toB):void 0,O="delete"===f||"insert+delete"===f?b.startDoc.textBetween(j.fromA,j.toA):void 0;t=function(e,t,n){Object(u.render)(Object(m.jsx)(se,Object(g.a)({},n)),t);var r=Object(ae.a)(e,t,{placement:"bottom"});return{destroy:function(){Object(u.unmountComponentAtNode)(t),r.destroy()}}}(s,n,{change:{type:f,timeStr:"02-13-2019 11:20AM",inserted:p,deleted:O,author:{name:"John Doe"}},comments:[],onClose:function(){var e;null===(e=t)||void 0===e||e.destroy()},onAccept:function(){var n;e.dispatch(e.state.tr.setMeta("accept-change",h)),null===(n=t)||void 0===n||n.destroy()},onReject:function(){var n,r=b.startDoc.slice(j.fromA,j.toA);e.dispatch(e.state.tr.replaceWith(j.fromB,j.toB,r.content)),null===(n=t)||void 0===n||n.destroy()},onSubmitReply:function(e){return console.log("submitted",e),Promise.resolve()}})}return!1}}})};function Me(e){var t=e.className,n=V().viewProvider,r=G(Se);return Object(m.jsx)(Ne,{className:t,children:null===r||void 0===r?void 0:r.changeSet.changes.map((function(e,t){return Object(m.jsxs)(Ce,{children:[Object(m.jsxs)(Ee,{children:[Object(m.jsx)("h4",{children:e.deleted.length>0?e.inserted.length>0?"Insertion + Deletion":"Deletion":"Insertion"}),Object(m.jsxs)(Be,{children:[Object(m.jsx)("button",{onClick:function(){return e=t,void n.view.dispatch(n.view.state.tr.setMeta("accept-change",e));var e},children:"Accept"}),Object(m.jsx)("button",{onClick:function(){return function(e){var t=r.changeSet,c=t.changes[e],i=t.startDoc.slice(c.fromA,c.toA);n.view.dispatch(n.view.state.tr.replaceWith(c.fromB,c.toB,i.content))}(t)},children:"Reject"})]})]}),Object(m.jsxs)(_e,{children:[Object(m.jsxs)("span",{className:"msg",children:["fromA: ",e.fromA]}),Object(m.jsxs)("span",{className:"msg",children:["toA: ",e.toA]}),Object(m.jsxs)("span",{className:"msg",children:["fromB: ",e.fromB]}),Object(m.jsxs)("span",{className:"msg",children:["toB: ",e.toB]})]})]},t)}))})}var Ne=f.a.ul(le||(le=Object(h.a)(["\n  display: flex;\n  flex-direction: column;\n  list-style: none;\n  padding: 0;\n  & > li + li {\n    margin-top: 1rem;\n  }\n"]))),Ce=f.a.li(ue||(ue=Object(h.a)(["\n"]))),Ee=f.a.div(de||(de=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  justify-content: space-between;\n  & > h4 {\n    margin: 0;\n    margin-right: 1rem;\n  }\n"]))),Be=f.a.div(be||(be=Object(h.a)(["\n  display: flex;\n  margin: 0.25rem 0;\n  button + button {\n    margin-left: 0.5rem;\n  }\n"]))),_e=f.a.div(he||(he=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  & > .msg {\n    margin-right: 1rem;\n  }\n"]))),Ie=n(109),Re=new(n(1).i)({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(e){var t=e;return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function(e){var t=e.attrs;return["img",{src:t.src,alt:t.alt,title:t.title}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(e){var t=e;return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function(e){var t=e.attrs;return["a",{href:t.href,title:t.title},0]}},italic:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em",0]}},bold:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return"normal"!=e.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function(){return["strong",0]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code",0]}},strikethrough:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"},{style:"text-decoration-line=line-through"}],toDOM:function(){return["s"]}}}});n(233),n(234),n(235);function ze(e){var t=e.className,n=void 0===t?"":t,r=Object(l.useRef)(null),c=Object(l.useRef)(null),i=V();function a(t){if(c.current){var n=c.current.state.apply(t);c.current.updateState(n),e.onEdit&&e.onEdit(n)}}return Object(l.useLayoutEffect)((function(){var t=U.b.create({schema:Re,plugins:Object(Ie.a)({schema:Re}).concat(Ae())}),n=r.current;return n&&(c.current=function(e,t){var n=new ce.c({mount:e},{state:t,dispatchTransaction:a});window&&(window.editorView=n);return n}(n,t),i.viewProvider.init(c.current),e.onEditorReady&&(null===e||void 0===e||e.onEditorReady(c.current))),function(){var e;null===(e=c.current)||void 0===e||e.destroy()}}),[]),Object(m.jsx)("div",{id:"example-editor",ref:r,className:n})}var Pe,Je=function e(t){var n=this;if(Object(I.a)(this,e),this._view=void 0,this.jsonEditorState=void 0,this.localStorageKey=void 0,this.setEditorView=function(e){if(n._view=e,n.jsonEditorState){var t=U.b.fromJSON({schema:n._view.state.schema,plugins:n._view.state.plugins},n.jsonEditorState);n._view.updateState(t)}},this.syncCurrentEditorState=function(){var e;localStorage.setItem(n.localStorageKey,JSON.stringify(null===(e=n._view)||void 0===e?void 0:e.state.toJSON()))},this.localStorageKey=t,"undefined"!==typeof window){var r=localStorage.getItem(this.localStorageKey);if(r&&null!==r&&r.length>0){var c=JSON.parse(r);this.jsonEditorState=c}}};function Ve(){var e=Object(l.useMemo)((function(){return new Je("track-changes")}),[]),t=Object(l.useMemo)((function(){return E()(e.syncCurrentEditorState,250)}),[]);return Object(m.jsxs)(J.Provider,{value:P(),children:[Object(m.jsx)(W,{}),Object(m.jsxs)(Ke,{children:[Object(m.jsx)(ze,{onEdit:function(){t()},onEditorReady:function(t){e.setEditorView(t),Object(B.a)(t)}}),Object(m.jsx)(Me,{className:"changes-list"})]})]})}var We,Ke=f.a.div(Pe||(Pe=Object(h.a)(["\n  display: flex;\n  width: 100%;\n  .changes-list {\n    margin-left: 1rem;\n  }\n"])));function qe(){return Object(m.jsxs)(Te,{children:[Object(m.jsx)(D,{}),Object(m.jsx)(Ve,{})]})}var Te=f.a.div(We||(We=Object(h.a)([""]))),Ue=function(){return Object(m.jsx)(d.a,{basename:"/prosemirror-track-changes-example",children:Object(m.jsxs)(b.d,{children:[Object(m.jsx)(y,{exact:!0,path:"/",component:qe}),Object(m.jsx)(b.a,{to:"/"})]})})};n(236);Object(u.render)(Object(m.jsx)(Ue,{}),document.getElementById("root"))}},[[237,1,2]]]);
//# sourceMappingURL=main.01e56293.chunk.js.map