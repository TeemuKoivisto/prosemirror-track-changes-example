(this["webpackJsonpprosemirror-track-changes-example"]=this["webpackJsonpprosemirror-track-changes-example"]||[]).push([[0],{226:function(t,e,n){},227:function(t,e,n){},228:function(t,e,n){},229:function(t,e,n){},230:function(t,e,n){"use strict";n.r(e);var r,a,c,o,i,s,u=n(0),l=n(33),d=n(46),h=n(5),g=n(10),b=n(73),f=n(14),p=n(11),j=n(3),O=function(t){var e=t.className;return Object(j.jsx)(m,{className:e,children:Object(j.jsx)(v,{children:Object(j.jsx)(x,{to:"/",exact:!0,activeClassName:"current",children:"Front page"})})})},m=p.a.div(r||(r=Object(g.a)(["\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n"]))),v=p.a.nav(a||(a=Object(g.a)(["\n  align-items: center;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n"]))),x=Object(p.a)(d.b)(c||(c=Object(g.a)(["\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n"]))),k=["component"],D=function(t){var e,n=t.component,r=Object(b.a)(t,k);return Object(j.jsx)(h.b,Object(f.a)(Object(f.a)({},r),{},{render:(e=n,function(t){return Object(j.jsxs)(w,{children:[Object(j.jsx)(O,Object(f.a)({},t)),Object(j.jsx)(y,{children:Object(j.jsx)(e,Object(f.a)({},t))})]})})}))},w=p.a.div(o||(o=Object(g.a)(["\n  min-height: 100vh;\n"]))),y=p.a.main(i||(i=Object(g.a)(["\n  margin: 40px auto 0 auto;\n  max-width: 680px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n"])));function M(t){var e=t.className;return Object(j.jsx)(C,{className:e,children:Object(j.jsxs)("header",{children:[Object(j.jsx)("h1",{children:Object(j.jsx)("a",{href:"https://teemukoivisto.github.io/prosemirror-track-changes-example/",children:"Track changes example"})}),Object(j.jsx)("p",{children:"With prosemirror-changeset"}),Object(j.jsx)("p",{children:Object(j.jsx)("a",{href:"https://github.com/TeemuKoivisto/prosemirror-track-changes-example",children:"Github repo"})})]})})}var S,E,C=p.a.div(s||(s=Object(g.a)(["\n"]))),I=n(94),N=n.n(I),A=n(104),J=n(95),K=n(2),R=function t(e){var n=this;if(Object(J.a)(this,t),this.view=void 0,this.currentEditorState=void 0,this.localStorageKey=void 0,this.setUserID=function(t){var e,r;null===(e=n.view)||void 0===e||e.dispatch(null===(r=n.view)||void 0===r?void 0:r.state.tr.setMeta("set-userID",t))},this.setEditorView=function(t){if(n.view=t,n.currentEditorState){var e=K.b.fromJSON({schema:n.view.state.schema,plugins:n.view.state.plugins},n.currentEditorState);n.view.updateState(e)}},this.syncCurrentEditorState=function(){var t=n.view.state.toJSON();localStorage.setItem(n.localStorageKey,JSON.stringify(t))},this.localStorageKey=e,"undefined"!==typeof window){var r=localStorage.getItem(this.localStorageKey);if(r&&null!==r&&r.length>0){var a=JSON.parse(r);this.currentEditorState=a}}},U=Object(u.createContext)(new R("editor-store"));function z(t){var e=t.className,n=Object(u.useState)("1"),r=Object(A.a)(n,2),a=r[0],c=r[1],o=Object(u.useContext)(U);function i(t){o.setUserID(t),c(t)}return Object(j.jsxs)(q,{className:e,children:[Object(j.jsxs)("div",{className:"current-user",children:["Current user: ",a]}),Object(j.jsxs)("div",{children:[Object(j.jsx)(T,{onClick:function(){return i("1")},children:"User 1"}),Object(j.jsx)(T,{onClick:function(){return i("2")},children:"User 2"}),Object(j.jsx)(T,{onClick:function(){return i("3")},children:"User 3"})]})]})}var B,q=p.a.div(S||(S=Object(g.a)(["\n  align-items: center;\n  display: flex;\n  .current-user {\n    margin: 0.25rem 1rem 0.25rem 0;\n  }\n"]))),T=p.a.button(E||(E=Object(g.a)(["\n  cursor: pointer;\n  & + & {\n    margin-left: 0.5rem;\n  }\n"]))),V=n(102),W=n(16),_=n(103),F=new(n(1).i)({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(t){var e=t;return{src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt")}}}],toDOM:function(t){var e=t.attrs;return["img",{src:e.src,alt:e.alt,title:e.title}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(t){var e=t;return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:function(t){var e=t.attrs;return["a",{href:e.href,title:e.title},0]}},italic:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em",0]}},bold:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!=t.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}}],toDOM:function(){return["strong",0]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code",0]}},strikethrough:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"},{style:"text-decoration-line=line-through"}],toDOM:function(){return["s"]}}}}),G=n(101),L=new K.e("track-changes"),P=[["greenyellow","#ffa4a4"],["#10c727","#ff0707"],["#7adcb8","#f93aa2"]],$=function(){return new K.d({key:L,state:{init:function(t,e){return{changeSet:G.a.create(e.doc),decorationSet:W.b.empty,userColors:new Map,userID:"1"}},apply:function(t,e,n,r){if(t.getMeta("set-userID"))return Object(f.a)(Object(f.a)({},e),{},{userID:t.getMeta("set-userID")});var a=e.changeSet,c=e.userColors,o=e.userID;c.has(o)||c.set(o,P[c.size]);var i=a.addSteps(t.doc,t.mapping.maps,{userID:o}),s=[],u=0,l=0;return i.changes.forEach((function(t){var r=t.fromB;t.inserted.forEach((function(n){var a=e.userColors.get(n.data.userID),c="background: ".concat(a?a[0]:"",";");s.push(W.a.inline(r,t.toB,{style:c})),r+=n.length,l+=n.length}));var a=0;t.deleted.forEach((function(r){var c=t.fromA+a,o=i.startDoc.textBetween(c,c+r.length),d=e.userColors.get(r.data.userID),h="background: ".concat(d?d[1]:"",";");s.push(W.a.widget(c+u+l,function(t,e){return function(n,r){var a=document.createElement("span");return a.textContent=t,a.setAttribute("style",e),a}}(o,h),{side:0,marks:[n.schema.marks.strikethrough.create()]})),u-=r.length,a+=r.length}))})),{changeSet:i,decorationSet:W.b.create(t.doc,s),userColors:c,userID:o}}},props:{decorations:function(t){return this.getState(t).decorationSet}}})};n(226),n(227),n(228);function H(t){var e=t.className,n=void 0===e?"":e,r=Object(u.useRef)(null),a=Object(u.useRef)(null);function c(e){if(a.current){var n=a.current.state.apply(e);a.current.updateState(n),t.onEdit&&t.onEdit(n)}}return Object(u.useLayoutEffect)((function(){var e=K.b.create({schema:F,plugins:Object(_.a)({schema:F}).concat($())}),n=r.current;return n&&(a.current=function(t,e){var n=new W.c({mount:t},{state:e,dispatchTransaction:c});window&&(window.editorView=n);return n}(n,e),t.onEditorReady&&(null===t||void 0===t||t.onEditorReady(a.current))),function(){var t;null===(t=a.current)||void 0===t||t.destroy()}}),[]),Object(j.jsx)("div",{id:"example-editor",ref:r,className:n})}function Q(){var t=Object(u.useMemo)((function(){return new R("track-changes")}),[]),e=Object(u.useMemo)((function(){return N()(t.syncCurrentEditorState,250)}),[]);return Object(j.jsxs)(U.Provider,{value:t,children:[Object(j.jsx)(z,{}),Object(j.jsx)(H,{onEdit:function(){e()},onEditorReady:function(e){t.setEditorView(e),Object(V.a)(e)}})]})}function X(){return Object(j.jsxs)(Y,{children:[Object(j.jsx)(M,{}),Object(j.jsx)(Q,{})]})}var Y=p.a.div(B||(B=Object(g.a)([""]))),Z=function(){return Object(j.jsx)(d.a,{basename:"/prosemirror-track-changes-example",children:Object(j.jsxs)(h.d,{children:[Object(j.jsx)(D,{exact:!0,path:"/",component:X}),Object(j.jsx)(h.a,{to:"/"})]})})};n(229);Object(l.render)(Object(j.jsx)(Z,{}),document.getElementById("root"))}},[[230,1,2]]]);
//# sourceMappingURL=main.963a97da.chunk.js.map