{"version":3,"sources":["components/NavBar.tsx","components/WrappedRoute.tsx","components/PageHeader.tsx","pm/EditorViewProvider.ts","pm/Providers.ts","pm/EditorContext.ts","components/SelectUser.tsx","components/usePluginState.ts","pm/track-changes/CommentPopUp.tsx","pm/track-changes/track-changes-plugin.ts","components/ChangesList.tsx","pm/schema.ts","pm/PMEditor.tsx","components/EditorStore.ts","components/Editor.tsx","pages/FrontPage.tsx","routes.tsx","index.tsx"],"names":["NavBar","props","className","Container","Nav","Link","to","exact","activeClassName","styled","div","nav","NavLink","WrappedRoute","Component","component","rest","render","MainWrapper","MainContainer","main","PageHeader","href","EditorViewProvider","_view","view","this","Error","cmd","state","dispatch","createDefaultProviders","viewProvider","ReactEditorContext","createContext","useEditorContext","useContext","SelectUser","useState","userID","setUserID","handleSelectUser","id","tr","setMeta","Button","onClick","button","updatePluginWatcher","watcher","remove","newPlugins","plugins","filter","p","reconfigure","updateState","usePluginState","pluginKey","getState","setState","useEffect","plugin","Plugin","key","PluginKey","update","prevState","newPluginState","watcherPlugin","CommentPopUp","change","comments","onClose","onAccept","onReject","onSubmitReply","reply","setReply","CornerX","CloseIconBtn","size","List","Item","UserInfo","Name","author","name","Time","timeStr","inserted","deleted","map","c","user","text","ReplyInput","placeholder","value","onChange","e","target","Buttons","AcceptBtn","ul","li","time","input","trackChangesPluginKey","colorScheme","trackChangesPlugin","renderedPopper","popUpElement","document","createElement","querySelector","appendChild","init","config","changeSet","ChangeSet","create","doc","decorationSet","DecorationSet","empty","userColors","Map","apply","oldState","newState","getMeta","oldChangeSet","changeIndex","Number","isNaN","addSteps","mapping","maps","acceptedChange","changes","slice","fromB","toB","startState","EditorState","schema","startDoc","replaceWith","fromA","toA","content","beforeChanges","afterChanges","lenA","Change","has","set","decorations","allDeletionsLength","allInsertsLength","forEach","index","insertFrom","changeType","length","span","colors","get","data","style","push","Decoration","inline","toString","deletionsLength","start","textBetween","attrs","widget","getPos","element","textContent","Object","keys","setAttribute","deletedWidget","side","marks","strikethrough","handleClickOn","_pos","_node","_nodePos","event","_direct","el","undefined","dataChangeIndex","getAttribute","dataChangeType","container","popper","createPopper","placement","destroy","unmountComponentAtNode","renderCommentPopUp","type","console","log","Promise","resolve","ChangesList","trackChangesState","i","CommitItem","TitleWrapper","idx","handleRejectChange","Ranges","Schema","nodes","paragraph","group","parseDOM","tag","toDOM","blockquote","defining","horizontal_rule","heading","level","default","node","code_block","code","preserveWhitespace","image","src","alt","title","draggable","getAttrs","dom","hard_break","selectable","link","inclusive","italic","bold","fontWeight","test","PMEditor","editorViewRef","useRef","editorRef","ctx","dispatchTransaction","transaction","current","editorState","onEdit","useLayoutEffect","exampleSetup","concat","editorViewDOM","EditorView","mount","window","editorView","createEditorView","onEditorReady","ref","EditorStore","jsonEditorState","localStorageKey","setEditorView","fromJSON","syncCurrentEditorState","localStorage","setItem","JSON","stringify","toJSON","existing","getItem","stored","parse","Editor","editorStore","useMemo","debouncedSync","debounce","Provider","EditorWrapper","applyDevTools","FrontPage","Routes","basename","process","path","getElementById"],"mappings":"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","file":"static/js/main.01e56293.chunk.js","sourcesContent":["import React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { RouteComponentProps } from 'react-router'\n\ninterface IProps extends RouteComponentProps<{}> {\n  className?: string\n}\n\nexport const NavBar = (props: IProps) => {\n  const { className} = props\n  return (\n    <Container className={className}>\n      <Nav>\n        <Link to=\"/\" exact activeClassName=\"current\">Front page</Link>\n      </Nav>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n`\nconst Nav = styled.nav`\n  align-items: center;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n`\nconst Link = styled(NavLink)`\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n`\n","import * as React from 'react'\nimport { Route, RouteProps, RouteComponentProps } from 'react-router'\nimport styled from 'styled-components'\n\nimport { NavBar } from './NavBar'\n\ntype ReactComponent = React.ComponentClass<any> | React.StatelessComponent<any>\n\ninterface IWrappedRoute extends RouteProps {\n  component: ReactComponent\n}\n\nconst renderNoMainContainerWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <Component {...props}/>\n  </MainWrapper>\n\nconst renderWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <MainContainer>\n      <Component {...props}/>\n    </MainContainer>\n  </MainWrapper>\n\nexport const NoMainContainerRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderNoMainContainerWrapper(component)}/>\n\nexport const WrappedRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderWrapper(component)}/>\n\nconst MainWrapper = styled.div`\n  min-height: 100vh;\n`\nconst MainContainer = styled.main`\n  margin: 40px auto 0 auto;\n  max-width: 800px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n`\n","import * as React from 'react'\nimport styled from 'styled-components'\n\ninterface IProps {\n  className?: string\n}\n\nexport function PageHeader(props: IProps) {\n  const { className } = props\n  return (\n    <Container className={className}>\n      <header>\n        <h1><a href=\"https://teemukoivisto.github.io/prosemirror-track-changes-example/\">\n          Track changes example</a></h1>\n        <p>With prosemirror-changeset</p>\n        <p><a href=\"https://github.com/TeemuKoivisto/prosemirror-track-changes-example\">Github repo</a></p>\n      </header>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import { EditorView } from 'prosemirror-view'\nimport { ExampleSchema } from './schema'\n\nimport { Command } from './editor-types'\n\nexport class EditorViewProvider {\n  _view?: EditorView<ExampleSchema>\n\n  init(view: EditorView<ExampleSchema>) {\n    this._view = view\n  }\n\n  get view(): EditorView<ExampleSchema> {\n    if (!this._view) {\n      throw Error('EditorViewProvider editorView accessed without editorView instance')\n    }\n    return this._view\n  }\n\n  execCommand(cmd: Command) {\n    cmd(this.view.state, this.view.dispatch)\n  }\n}","import { EditorViewProvider } from './EditorViewProvider'\n\nexport interface IProviders {\n  viewProvider: EditorViewProvider\n}\n\nexport const createDefaultProviders = (): IProviders => {\n  const viewProvider = new EditorViewProvider()\n  return {\n    viewProvider,\n  }\n}\n","import { createContext, useContext } from 'react'\nimport { IProviders, createDefaultProviders } from './Providers'\n\nexport type EditorContext = IProviders\n\nexport const ReactEditorContext = createContext<EditorContext>(createDefaultProviders())\n\nexport const useEditorContext = () => useContext(ReactEditorContext)\n","import React, { useState } from 'react'\nimport styled from 'styled-components'\n\nimport { useEditorContext } from 'pm/EditorContext'\n\ninterface IProps {\n  className?: string\n}\n\nexport function SelectUser(props: IProps) {\n  const { className } = props\n  const [userID, setUserID] = useState('1')\n  const { viewProvider } = useEditorContext()\n\n  function handleSelectUser(id: string) {\n    const view = viewProvider.view\n    view.dispatch(view.state.tr.setMeta('set-userID', id))\n    setUserID(id)\n  }\n  return (\n    <Container className={className}>\n      <div className=\"current-user\">\n        Current user: {userID}\n      </div>\n      <div>\n        <Button onClick={() => handleSelectUser('1')}>User 1</Button>\n        <Button onClick={() => handleSelectUser('2')}>User 2</Button>\n        <Button onClick={() => handleSelectUser('3')}>User 3</Button>\n      </div>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  align-items: center;\n  display: flex;\n  .current-user {\n    margin: 0.25rem 1rem 0.25rem 0;\n  }\n`\nconst Button = styled.button`\n  cursor: pointer;\n  & + & {\n    margin-left: 0.5rem;\n  }\n`","import { useState, useEffect } from 'react'\nimport { Plugin, PluginKey } from 'prosemirror-state'\nimport { EditorView } from 'prosemirror-view'\n\nimport { ExampleSchema } from 'pm/schema'\n\nimport { useEditorContext } from 'pm/EditorContext'\n\n// Modified from https://github.com/bangle-io/bangle.dev/blob/master/react/hooks.jsx\n\nconst updatePluginWatcher = (view: EditorView, watcher: Plugin<any, ExampleSchema>, remove = false) => {\n  let state = view.state\n\n  const newPlugins = remove\n    ? state.plugins.filter((p) => p !== watcher)\n    : [...state.plugins, watcher]\n\n  state = state.reconfigure({\n    plugins: newPlugins,\n  })\n\n  view.updateState(state)\n}\n\nexport function usePluginState(pluginKey: PluginKey) {\n  const { viewProvider } = useEditorContext()\n  const [state, setState] = useState(viewProvider._view ? pluginKey.getState(viewProvider._view.state) : null)\n\n  useEffect(() => {\n    const view = viewProvider._view\n    if (!view) return\n    const plugin = watcherPlugin(pluginKey, setState)\n    updatePluginWatcher(view, plugin)\n    return () => {\n      updatePluginWatcher(view, plugin, true)\n    }\n  }, [viewProvider._view, pluginKey])\n\n  return state\n}\n\nexport function watcherPlugin(pluginKey: PluginKey, setState: (newState: any) => void) {\n  return new Plugin({\n    // @ts-ignore\n    key: new PluginKey(`withPluginState_${pluginKey.key}`),\n    view() {\n      return {\n        update(view: EditorView, prevState: any) {\n          const { state } = view\n          if (prevState === state) {\n            return\n          }\n          const newPluginState = pluginKey.getState(state)\n          if (newPluginState !== pluginKey.getState(prevState)) {\n            setState(newPluginState)\n          }\n        },\n      }\n    },\n  })\n}","import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport { render, unmountComponentAtNode } from 'react-dom'\nimport { createPopper } from '@popperjs/core'\n\nimport { FiCheck, FiX } from 'react-icons/fi'\n\nimport { Comment, TrackedChange } from './types'\n\nexport function renderCommentPopUp(target: HTMLElement, container: HTMLElement, props: Props) {\n  render(<CommentPopUp {...props}/>, container)\n  const popper = createPopper(target, container, {\n    placement: 'bottom',\n  })\n  return {\n    destroy() {\n      unmountComponentAtNode(container)\n      popper.destroy()\n    }\n  }\n}\n\ninterface Props {\n  change: TrackedChange\n  comments: Comment[]\n  onClose: () => void\n  onAccept: () => void\n  onReject: () => void\n  onSubmitReply: (text: string) => Promise<void>\n}\n\nfunction CommentPopUp(props: Props) {\n  const { change, comments, onClose, onAccept, onReject, onSubmitReply } = props\n  const [reply, setReply] = useState('')\n  function handleKeyPress(e: React.KeyboardEvent) {\n\n  }\n  return (\n    <Container>\n      <CornerX>\n        <CloseIconBtn onClick={() => onClose()}><FiX size={14}/></CloseIconBtn>\n      </CornerX>\n      <List>\n        <Item>\n          <UserInfo>\n            <Name>{change.author.name}</Name>\n            <Time>{change.timeStr}</Time>\n          </UserInfo>\n          { change.inserted && <div>inserted: \"{change.inserted}\"</div>}\n          { change.deleted && <div>deleted: \"{change.deleted}\"</div>}\n        </Item>\n        { comments.map(c =>          \n        <Item key={c.id}>\n          <UserInfo>\n            <Name>{c.user.name}</Name>\n            <Time>{c.timeStr}</Time>\n          </UserInfo>\n          <div>\n            {c.text}\n          </div>\n        </Item>\n        )}\n      </List>\n      <ReplyInput placeholder=\"Reply...\" value={reply} onChange={e => setReply(e.target.value)}/>\n      <Buttons>\n        <AcceptBtn className=\"accept\" onClick={() => onAccept()}>\n          <FiCheck size={14}/>\n        </AcceptBtn>\n        <AcceptBtn className=\"reject\" onClick={() => onReject()}>\n          <FiX size={14}/>\n        </AcceptBtn>\n      </Buttons>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  background: #333;\n  color: white;\n  padding: 1rem;\n  position: relative;\n  font-size: 13px;\n  border-radius: 4px;\n`\nconst List = styled.ul`\n  list-style: none;\n  margin: 0;\n  padding: 0;\n`\nconst Item = styled.li`\n  & > div {\n    display: flex;\n    margin-bottom: 0.25rem;\n  }\n`\nconst CornerX = styled.div`\n  position: absolute;\n  right: -6px;\n  top: -6px;\n`\nconst CloseIconBtn = styled.button`\n  align-items: center;\n  background: #333;\n  border: 0;\n  border-radius: 100%;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  padding: 0.25rem;\n`\nconst UserInfo = styled.div`\n  display: flex;\n`\nconst Name = styled.div`\n  margin-right: 1rem;\n`\nconst Time = styled.time``\nconst ReplyInput = styled.input`\n  background: #e4e4e4;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  height: 1rem;\n  margin-top: 0.5rem;\n  padding: 0.75rem 0.5rem;\n  width: 100%;\n`\nconst Buttons = styled.div`\n  display: flex;\n  margin-top: 1rem;\n  & > button + button {\n    margin-left: 1rem;\n  }\n`\nconst AcceptBtn = styled.button`\n  align-items: center;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  cursor: pointer;\n  display: flex;\n  padding: 0.25rem 0.75rem;\n  justify-content: center;\n  &.accept {\n    background: #16d816;\n  }\n  &.reject {\n    background: #ff3c3c;\n  }\n`\n","import { EditorView, Decoration, DecorationSet } from 'prosemirror-view'\nimport { EditorState, Plugin, PluginKey } from 'prosemirror-state'\nimport { Change, ChangeSet } from 'prosemirror-changeset'\n\nimport { renderCommentPopUp } from './CommentPopUp'\n\nimport { ExampleSchema } from '../schema'\nimport { TrackedChangeType } from './types'\n\nexport interface TrackChangesState {\n  changeSet: ChangeSet\n  decorationSet: DecorationSet<ExampleSchema>\n  userColors: Map<string, [string, string]>\n  userID: string\n}\n\nexport const trackChangesPluginKey = new PluginKey<TrackChangesState, ExampleSchema>('track-changes')\n\nconst colorScheme: [string, string][] = [\n  ['greenyellow', '#ffa4a4'],\n  ['#10c727', '#ff0707'],\n  ['#7adcb8', '#f93aa2']\n]\n\nconst deletedWidget = (content: string, attrs: {[key: string]: string}) => (view: EditorView, getPos: () => number) => {\n  const element = document.createElement('span')\n  element.textContent = content\n  Object.keys(attrs).forEach((key) => {\n    element.setAttribute(key, attrs[key])\n  })\n  return element\n}\n\nexport const trackChangesPlugin = () => {\n\n  const popUpElement = document.createElement('div')\n  popUpElement.id = 'track-changes-comment-pop-up'\n  document.querySelector('body')?.appendChild(popUpElement)\n  let renderedPopper: {\n    destroy: () => void\n  } | undefined\n\n  return new Plugin<TrackChangesState, ExampleSchema>({\n    key: trackChangesPluginKey,\n    state: {\n      init(config, state) {\n        return {\n          changeSet: ChangeSet.create(state.doc),\n          decorationSet: DecorationSet.empty,\n          userColors: new Map(),\n          userID: '1',\n        }\n      },\n\n      apply(tr, value, oldState, newState) {\n        if (tr.getMeta('set-userID')) {\n          return { ...value, userID: tr.getMeta('set-userID') }\n        }\n        const { changeSet: oldChangeSet, userColors, userID } = value\n        let changeSet: ChangeSet\n        const changeIndex = Number(tr.getMeta('accept-change'))\n        if (!Number.isNaN(changeIndex)) {\n          const acceptedChange = oldChangeSet.changes[changeIndex]\n          const slice = oldState.doc.slice(acceptedChange.fromB, acceptedChange.toB)\n          let startState = EditorState.create({\n            schema: oldState.schema,\n            doc: oldChangeSet.startDoc,\n          })\n          startState = startState.apply(startState.tr.replaceWith(acceptedChange.fromA, acceptedChange.toA, slice.content))\n          // The changes before the accepted change stay as previously, only the changes afterwards must be updated\n          // to account for the changed startDoc\n          const beforeChanges = oldChangeSet.changes.slice(0, changeIndex)\n          const afterChanges = oldChangeSet.changes.slice(changeIndex + 1).map(c => {\n            const fromA = c.fromA - acceptedChange.lenA + slice.content.size\n            const toA = c.toA - acceptedChange.lenA + slice.content.size\n            return new Change(fromA, toA, c.fromB, c.toB, c.deleted, c.inserted)\n          })\n          const changes = [...beforeChanges, ...afterChanges]\n          // @ts-ignore\n          changeSet = new ChangeSet({ ...oldChangeSet.config, doc: startState.doc }, changes)\n        } else {\n          changeSet = oldChangeSet.addSteps(tr.doc, tr.mapping.maps, { userID })\n        }\n\n        if (!userColors.has(userID)) {\n          userColors.set(userID, colorScheme[userColors.size])\n        }\n        const decorations: Decoration[] = []\n        let allDeletionsLength = 0\n        let allInsertsLength = 0\n\n        changeSet.changes.forEach((change, index) => {\n          let insertFrom = change.fromB\n          const { inserted, deleted } = change\n          const changeType = change.deleted.length > 0 ? change.inserted.length > 0 ? 'insert+delete' : 'delete' : 'insert'\n          inserted.forEach((span) => {\n            const colors = value.userColors.get(span.data.userID)\n            const style = `background: ${colors ? colors[0] : ''};`\n            decorations.push(Decoration.inline(insertFrom, change.toB, {\n              style,\n              'data-change-type': changeType,\n              'data-change-index': index.toString(),\n            }))\n            // @ts-ignore\n            insertFrom += span.length\n            // @ts-ignore\n            allInsertsLength += span.length\n          })\n\n          let deletionsLength = 0\n          deleted.forEach((span) => {\n            const start = change.fromA + deletionsLength\n            // @ts-ignore\n            const content = changeSet.startDoc.textBetween(start, start + span.length)\n            const colors = value.userColors.get(span.data.userID)\n            const style = `background: ${colors ? colors[1] : ''};`\n            const attrs = {\n              style,\n              'data-change-type': changeType,\n              'data-change-index': index.toString(),\n            }\n            decorations.push(\n              Decoration.widget(start + allDeletionsLength + allInsertsLength, deletedWidget(content, attrs), {\n                side: 0,\n                marks: [oldState.schema.marks.strikethrough.create()],\n              })\n            )\n            // @ts-ignore\n            allDeletionsLength -= span.length\n            // @ts-ignore\n            deletionsLength += span.length\n          })\n        })\n        return {\n          changeSet,\n          decorationSet: DecorationSet.create(tr.doc, decorations),\n          userColors,\n          userID,\n        }\n      },\n    },\n    props: {\n      decorations(state) {\n        return this.getState(state).decorationSet\n      },\n      handleClickOn(view, _pos, _node, _nodePos, event, _direct) {\n        const el = event.target ? event.target as HTMLElement : undefined\n        const dataChangeIndex = el?.getAttribute('data-change-index')\n        const dataChangeType = el?.getAttribute('data-change-type')\n\n        if (el && dataChangeIndex && dataChangeType) {\n          const changeSet = this.getState(view.state).changeSet\n          const changeIndex = Number(dataChangeIndex)\n          const change = changeSet.changes[changeIndex]\n          const changeType = dataChangeType as TrackedChangeType\n          const inserted = (changeType === 'insert' || changeType === 'insert+delete') ?\n            view.state.doc.textBetween(change.fromB, change.toB) : undefined\n          const deleted = (changeType === 'delete' || changeType === 'insert+delete') ?\n            changeSet.startDoc.textBetween(change.fromA, change.toA) : undefined\n\n          const props = {\n            change: {\n              type: changeType,\n              timeStr: '02-13-2019 11:20AM',\n              inserted,\n              deleted,\n              author: {\n                name: 'John Doe'\n              }\n            },\n            comments: [],\n            onClose: () => {\n              renderedPopper?.destroy()\n            },\n            onAccept: () => {\n              view.dispatch(view.state.tr.setMeta('accept-change', changeIndex))\n              renderedPopper?.destroy()\n            },\n            onReject: () => {\n              const slice = changeSet.startDoc.slice(change.fromA, change.toA)\n              view.dispatch(view.state.tr.replaceWith(change.fromB, change.toB, slice.content))\n              renderedPopper?.destroy()\n            },\n            onSubmitReply: (text: string) => {\n              console.log('submitted', text)\n              return Promise.resolve()\n            }\n          }\n          renderedPopper = renderCommentPopUp(el, popUpElement, props)\n        }\n        return false\n      }\n    },\n  })\n}","import React from 'react'\nimport styled from 'styled-components'\nimport { Change } from 'prosemirror-changeset'\n\nimport { useEditorContext } from 'pm/EditorContext'\nimport { usePluginState } from './usePluginState'\n\nimport { TrackChangesState, trackChangesPluginKey } from 'pm/track-changes/track-changes-plugin'\n\ninterface IProps {\n  className?: string\n}\n\nexport function ChangesList(props: IProps) {\n  const { className } = props\n  const { viewProvider } = useEditorContext()\n  const trackChangesState: TrackChangesState = usePluginState(trackChangesPluginKey)\n\n  function handleAcceptChange(idx: number) {\n    viewProvider.view.dispatch(viewProvider.view.state.tr.setMeta('accept-change', idx))\n  }\n\n  function handleRejectChange(idx: number) {\n    const changeSet = trackChangesState.changeSet\n    const change = changeSet.changes[idx]\n    const slice = changeSet.startDoc.slice(change.fromA, change.toA)\n    viewProvider.view.dispatch(viewProvider.view.state.tr.replaceWith(change.fromB, change.toB, slice.content))\n  }\n\n  return (\n    <List className={className}>\n      { trackChangesState?.changeSet.changes.map((c: Change, i: number) =>\n      <CommitItem\n        key={i}\n      >\n        <TitleWrapper>\n          <h4>{ c.deleted.length > 0 ? c.inserted.length > 0 ? 'Insertion + Deletion' : 'Deletion' : 'Insertion'}</h4>\n          <Buttons>\n            <button onClick={() => handleAcceptChange(i)}>\n              Accept\n            </button>\n            <button onClick={() => handleRejectChange(i)}>\n              Reject\n            </button>\n          </Buttons>\n        </TitleWrapper>\n        <Ranges>\n          <span className=\"msg\">fromA: {c.fromA}</span>\n          <span className=\"msg\">toA: {c.toA}</span>\n          <span className=\"msg\">fromB: {c.fromB}</span>\n          <span className=\"msg\">toB: {c.toB}</span>\n        </Ranges>\n      </CommitItem>\n      )}\n    </List>\n  )\n}\n\nconst List = styled.ul`\n  display: flex;\n  flex-direction: column;\n  list-style: none;\n  padding: 0;\n  & > li + li {\n    margin-top: 1rem;\n  }\n`\nconst CommitItem = styled.li`\n`\nconst TitleWrapper = styled.div`\n  align-items: center;\n  display: flex;\n  justify-content: space-between;\n  & > h4 {\n    margin: 0;\n    margin-right: 1rem;\n  }\n`\nconst Buttons = styled.div`\n  display: flex;\n  margin: 0.25rem 0;\n  button + button {\n    margin-left: 0.5rem;\n  }\n`\nconst Ranges = styled.div`\n  align-items: center;\n  display: flex;\n  & > .msg {\n    margin-right: 1rem;\n  }\n`\n","import { Schema } from 'prosemirror-model'\n\nexport type Marks = 'bold' | 'code' | 'italic' | 'link' | 'strikethrough'\nexport type Nodes =\n  | 'blockquote'\n  | 'code_block'\n  | 'doc'\n  | 'hard_break'\n  | 'heading'\n  | 'horizontal_rule'\n  | 'image'\n  | 'paragraph'\n  | 'text'\nexport type ExampleSchema = Schema<Nodes, Marks>\n\nexport const schema: ExampleSchema = new Schema<Nodes, Marks>({\n  nodes: {\n    // :: NodeSpec The top level document node.\n    doc: {\n      content: 'block+',\n    },\n\n    // :: NodeSpec A plain paragraph textblock. Represented in the DOM\n    // as a `<p>` element.\n    paragraph: {\n      content: 'inline*',\n      group: 'block',\n      parseDOM: [{ tag: 'p' }],\n      toDOM() {\n        return ['p', 0]\n      },\n    },\n\n    // :: NodeSpec A blockquote (`<blockquote>`) wrapping one or more blocks.\n    blockquote: {\n      content: 'block+',\n      group: 'block',\n      defining: true,\n      parseDOM: [{ tag: 'blockquote' }],\n      toDOM() {\n        return ['blockquote', 0]\n      },\n    },\n\n    // :: NodeSpec A horizontal rule (`<hr>`).\n    horizontal_rule: {\n      group: 'block',\n      parseDOM: [{ tag: 'hr' }],\n      toDOM() {\n        return ['hr']\n      },\n    },\n\n    // :: NodeSpec A heading textblock, with a `level` attribute that\n    // should hold the number 1 to 6. Parsed and serialized as `<h1>` to\n    // `<h6>` elements.\n    heading: {\n      attrs: { level: { default: 1 } },\n      content: 'inline*',\n      group: 'block',\n      defining: true,\n      parseDOM: [\n        { tag: 'h1', attrs: { level: 1 } },\n        { tag: 'h2', attrs: { level: 2 } },\n        { tag: 'h3', attrs: { level: 3 } },\n        { tag: 'h4', attrs: { level: 4 } },\n        { tag: 'h5', attrs: { level: 5 } },\n        { tag: 'h6', attrs: { level: 6 } },\n      ],\n      toDOM(node) {\n        return ['h' + node.attrs.level, 0]\n      },\n    },\n\n    // :: NodeSpec A code listing. Disallows marks or non-text inline\n    // nodes by default. Represented as a `<pre>` element with a\n    // `<code>` element inside of it.\n    code_block: {\n      content: 'text*',\n      marks: '',\n      group: 'block',\n      code: true,\n      defining: true,\n      parseDOM: [{ tag: 'pre', preserveWhitespace: 'full' }],\n      toDOM() {\n        return ['pre', ['code', 0]]\n      },\n    },\n\n    // :: NodeSpec The text node.\n    text: {\n      group: 'inline',\n    },\n\n    // :: NodeSpec An inline image (`<img>`) node. Supports `src`,\n    // `alt`, and `href` attributes. The latter two default to the empty\n    // string.\n    image: {\n      inline: true,\n      attrs: {\n        src: {},\n        alt: { default: null },\n        title: { default: null },\n      },\n      group: 'inline',\n      draggable: true,\n      parseDOM: [\n        {\n          tag: 'img[src]',\n          getAttrs(p) {\n            const dom = p as HTMLElement\n            return {\n              src: dom.getAttribute('src'),\n              title: dom.getAttribute('title'),\n              alt: dom.getAttribute('alt'),\n            }\n          },\n        },\n      ],\n      toDOM(node) {\n        const { src, alt, title } = node.attrs\n        return ['img', { src, alt, title }]\n      },\n    },\n\n    // :: NodeSpec A hard line break, represented in the DOM as `<br>`.\n    hard_break: {\n      inline: true,\n      group: 'inline',\n      selectable: false,\n      parseDOM: [{ tag: 'br' }],\n      toDOM() {\n        return ['br']\n      },\n    },\n  },\n  marks: {\n    // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n    // defaults to the empty string. Rendered and parsed as an `<a>`\n    // element.\n    link: {\n      attrs: {\n        href: {},\n        title: { default: null },\n      },\n      inclusive: false,\n      parseDOM: [\n        {\n          tag: 'a[href]',\n          getAttrs(p) {\n            const dom = p as HTMLElement\n            return {\n              href: dom.getAttribute('href'),\n              title: dom.getAttribute('title'),\n            }\n          },\n        },\n      ],\n      toDOM(node) {\n        const { href, title } = node.attrs\n        return ['a', { href, title }, 0]\n      },\n    },\n\n    // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n    // Has parse rules that also match `<i>` and `font-style: italic`.\n    italic: {\n      parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n      toDOM() {\n        return ['em', 0]\n      },\n    },\n\n    // :: MarkSpec A strong mark. Rendered as `<strong>`, parse rules\n    // also match `<b>` and `font-weight: bold`.\n    bold: {\n      parseDOM: [\n        { tag: 'strong' },\n        // This works around a Google Docs misbehavior where\n        // pasted content will be inexplicably wrapped in `<b>`\n        // tags with a font-weight normal.\n        {\n          tag: 'b',\n          getAttrs: (p) => {\n            const node = p as HTMLElement\n            return node.style.fontWeight != 'normal' && null\n          },\n        },\n        {\n          style: 'font-weight',\n          getAttrs: (p) => {\n            const value = p as string\n            return /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null\n          },\n        },\n      ],\n      toDOM() {\n        return ['strong', 0]\n      },\n    },\n\n    // :: MarkSpec Code font mark. Represented as a `<code>` element.\n    code: {\n      parseDOM: [{ tag: 'code' }],\n      toDOM() {\n        return ['code', 0]\n      },\n    },\n\n    strikethrough: {\n      parseDOM: [\n        { tag: 's' },\n        { tag: 'strike' },\n        { style: 'text-decoration=line-through' },\n        { style: 'text-decoration-line=line-through' },\n      ],\n      toDOM: () => ['s'],\n    }\n  },\n})\n","import React, { useEffect, useLayoutEffect, useRef } from 'react'\nimport { EditorView } from 'prosemirror-view'\nimport { EditorState, Transaction } from 'prosemirror-state'\nimport { exampleSetup } from 'prosemirror-example-setup'\n\nimport { schema } from './schema'\nimport { trackChangesPlugin } from './track-changes/track-changes-plugin'\n\nimport { useEditorContext } from './EditorContext'\n\nimport './editor.css'\nimport './prosemirror-example-setup.css'\nimport './menu.css'\n\ninterface EditorProps {\n  className?: string\n  onEditorReady?: (view: EditorView) => void\n  onEdit?: (state: EditorState) => void\n}\n\nexport function PMEditor(props: EditorProps) {\n  const { className = '' } = props\n  const editorViewRef = useRef(null)\n  const editorRef = useRef<EditorView | null>(null)\n  const ctx = useEditorContext()\n\n  useLayoutEffect(() => {\n    const state = createEditorState()\n    const editorViewDOM = editorViewRef.current\n    if (editorViewDOM) {\n      editorRef.current = createEditorView(editorViewDOM, state)\n      ctx.viewProvider.init(editorRef.current)\n      props.onEditorReady && props?.onEditorReady(editorRef.current)\n    }\n    return () => {\n      editorRef.current?.destroy()\n    }\n  }, [])\n\n  function createEditorState() {\n    return EditorState.create({\n      schema,\n      plugins: exampleSetup({ schema }).concat(\n        trackChangesPlugin(),\n      ),\n    })\n  }\n\n  function createEditorView(element: HTMLDivElement, state: EditorState) {\n    const view = new EditorView({ mount: element }, {\n      state,\n      dispatchTransaction,\n    })\n    // @ts-ignore\n    if (window) window.editorView = view\n    return view\n  }\n\n  function dispatchTransaction(transaction: Transaction) {\n    if (!editorRef.current) {\n      return\n    }\n    const editorState = editorRef.current.state.apply(transaction)\n    editorRef.current.updateState(editorState)\n    if (props.onEdit) {\n      props.onEdit(editorState)\n    }\n  }\n\n  return (\n    <div id=\"example-editor\" ref={editorViewRef} className={className}/>\n  )\n}\n","import { EditorView } from 'prosemirror-view'\nimport { EditorState } from 'prosemirror-state'\nimport { ExampleSchema } from 'pm/schema'\n\nexport class EditorStore {\n\n  _view?: EditorView<ExampleSchema>\n  jsonEditorState?: {[key: string]: any}\n  localStorageKey: string\n\n  constructor(key: string) {\n    this.localStorageKey = key\n    if (typeof window !== 'undefined') {\n      const existing = localStorage.getItem(this.localStorageKey)\n      if (existing && existing !== null && existing.length > 0) {\n        let stored = JSON.parse(existing)\n        this.jsonEditorState = stored\n      }\n    }\n  }\n\n  setEditorView = (view: EditorView) => {\n    this._view = view\n    if (this.jsonEditorState) {\n      const state = EditorState.fromJSON(\n        {\n          schema: this._view.state.schema,\n          plugins: this._view.state.plugins,\n        },\n        this.jsonEditorState\n      )\n      this._view.updateState(state)\n    }\n  }\n\n  syncCurrentEditorState = () => {\n    localStorage.setItem(this.localStorageKey, JSON.stringify(this._view?.state.toJSON()))\n  }\n}","import React, { useMemo } from 'react'\nimport styled from 'styled-components'\nimport debounce from 'lodash.debounce'\n\nimport { EditorView } from 'prosemirror-view'\nimport { applyDevTools } from 'prosemirror-dev-tools'\n\nimport { SelectUser } from './SelectUser'\nimport { ChangesList } from './ChangesList'\n\nimport { PMEditor } from 'pm/PMEditor'\nimport { EditorStore } from './EditorStore'\nimport { ReactEditorContext } from 'pm/EditorContext'\nimport { createDefaultProviders } from 'pm/Providers'\n\nexport function Editor() {\n  const editorStore = useMemo(() => new EditorStore('track-changes'), [])\n  const debouncedSync = useMemo(() => debounce(editorStore.syncCurrentEditorState, 250), [])\n\n  function handleEdit() {\n    debouncedSync()\n  }\n  function handleEditorReady(view: EditorView) {\n    editorStore.setEditorView(view)\n    applyDevTools(view)\n  }\n  return (\n    <ReactEditorContext.Provider value={createDefaultProviders()}>\n      <SelectUser/>\n      <EditorWrapper>\n        <PMEditor\n          onEdit={handleEdit}\n          onEditorReady={handleEditorReady}\n        />\n        <ChangesList className=\"changes-list\"/>\n      </EditorWrapper>\n    </ReactEditorContext.Provider>\n  )\n}\n\nconst EditorWrapper = styled.div`\n  display: flex;\n  width: 100%;\n  .changes-list {\n    margin-left: 1rem;\n  }\n`","import React from 'react'\nimport styled from 'styled-components'\n\nimport { PageHeader } from '../components/PageHeader'\nimport { Editor } from '../components/Editor'\n\nexport function FrontPage() {\n  return (\n    <Container>\n      <PageHeader/>\n      <Editor/>\n    </Container>\n  )\n}\n\nconst Container = styled.div``\n","import * as React from 'react'\nimport { BrowserRouter, Redirect, Switch } from 'react-router-dom'\n\nimport { WrappedRoute } from './components/WrappedRoute'\n\nimport { FrontPage } from './pages/FrontPage'\n\nexport const Routes = () => (\n  <BrowserRouter basename={process.env.PUBLIC_URL}>\n    <Switch>\n      <WrappedRoute exact path=\"/\" component={FrontPage}/>\n      <Redirect to=\"/\" />\n    </Switch>\n  </BrowserRouter>\n)\n","import * as React from 'react'\nimport { render } from 'react-dom'\n\nimport { Routes } from './routes'\n\nimport './index.css'\n\nrender(\n  <Routes />,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}