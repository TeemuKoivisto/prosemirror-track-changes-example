(this["webpackJsonpprosemirror-track-changes-example"]=this["webpackJsonpprosemirror-track-changes-example"]||[]).push([[0],{233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){},236:function(e,t,n){},237:function(e,t,n){"use strict";n.r(t);var r,a,c,i,o,s,l=n(0),u=n(19),d=n(48),b=n(7),h=n(5),j=n(79),g=n(10),f=n(6),m=n(3),p=function(e){var t=e.className;return Object(m.jsx)(O,{className:t,children:Object(m.jsx)(v,{children:Object(m.jsx)(x,{to:"/",exact:!0,activeClassName:"current",children:"Front page"})})})},O=f.a.div(r||(r=Object(h.a)(["\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n"]))),v=f.a.nav(a||(a=Object(h.a)(["\n  align-items: center;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n"]))),x=Object(f.a)(d.b)(c||(c=Object(h.a)(["\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n"]))),w=["component"],y=function(e){var t,n=e.component,r=Object(j.a)(e,w);return Object(m.jsx)(b.b,Object(g.a)(Object(g.a)({},r),{},{render:(t=n,function(e){return Object(m.jsxs)(k,{children:[Object(m.jsx)(p,Object(g.a)({},e)),Object(m.jsx)(S,{children:Object(m.jsx)(t,Object(g.a)({},e))})]})})}))},k=f.a.div(i||(i=Object(h.a)(["\n  min-height: 100vh;\n"]))),S=f.a.main(o||(o=Object(h.a)(["\n  margin: 40px auto 0 auto;\n  max-width: 800px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n"])));function D(e){var t=e.className;return Object(m.jsx)(C,{className:t,children:Object(m.jsxs)("header",{children:[Object(m.jsx)("h1",{children:Object(m.jsx)("a",{href:"https://teemukoivisto.github.io/prosemirror-track-changes-example/",children:"Track changes example"})}),Object(m.jsx)("p",{children:"With prosemirror-changeset"}),Object(m.jsx)("p",{children:Object(m.jsx)("a",{href:"https://github.com/TeemuKoivisto/prosemirror-track-changes-example",children:"Github repo"})})]})})}var M,A,C=f.a.div(s||(s=Object(h.a)(["\n"]))),N=n(100),E=n.n(N),B=n(107),_=n(30),I=n(50),R=n(106),P=function(){function e(){Object(I.a)(this,e),this._view=void 0}return Object(R.a)(e,[{key:"init",value:function(e){this._view=e}},{key:"view",get:function(){if(!this._view)throw Error("EditorViewProvider editorView accessed without editorView instance");return this._view}},{key:"execCommand",value:function(e){e(this.view.state,this.view.dispatch)}}]),e}(),z=function(){return{viewProvider:new P}},J=Object(l.createContext)(z()),V=function(){return Object(l.useContext)(J)};function W(e){var t=e.className,n=Object(l.useState)("1"),r=Object(_.a)(n,2),a=r[0],c=r[1],i=V().viewProvider;function o(e){var t=i.view;t.dispatch(t.state.tr.setMeta("set-userID",e)),c(e)}return Object(m.jsxs)(K,{className:t,children:[Object(m.jsxs)("div",{className:"current-user",children:["Current user: ",a]}),Object(m.jsxs)("div",{children:[Object(m.jsx)(q,{onClick:function(){return o("1")},children:"User 1"}),Object(m.jsx)(q,{onClick:function(){return o("2")},children:"User 2"}),Object(m.jsx)(q,{onClick:function(){return o("3")},children:"User 3"})]})]})}var K=f.a.div(M||(M=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  .current-user {\n    margin: 0.25rem 1rem 0.25rem 0;\n  }\n"]))),q=f.a.button(A||(A=Object(h.a)(["\n  cursor: pointer;\n  & + & {\n    margin-left: 0.5rem;\n  }\n"]))),T=n(109),U=n(2),F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.state,a=n?r.plugins.filter((function(e){return e!==t})):[].concat(Object(T.a)(r.plugins),[t]);r=r.reconfigure({plugins:a}),e.updateState(r)};function G(e){var t=V().viewProvider,n=Object(l.useState)(t._view?e.getState(t._view.state):null),r=Object(_.a)(n,2),a=r[0],c=r[1];return Object(l.useEffect)((function(){var n=t._view;if(n){var r=function(e,t){return new U.d({key:new U.e("withPluginState_".concat(e.key)),view:function(){return{update:function(n,r){var a=n.state;if(r!==a){var c=e.getState(a);c!==e.getState(r)&&t(c)}}}}})}(e,c);return F(n,r),function(){F(n,r,!0)}}}),[t._view,e]),a}var L,$,H,Q,X,Y,Z,ee,te,ne,re,ae,ce=n(16),ie=n(78),oe=n(241),se=n(51);function le(e){var t=e.change,n=e.comments,r=e.onClose,a=e.onAccept,c=e.onReject,i=(e.onSubmitReply,Object(l.useState)("")),o=Object(_.a)(i,2),s=o[0],u=o[1];return Object(m.jsxs)(ge,{children:[Object(m.jsx)(pe,{children:Object(m.jsx)(Oe,{onClick:function(){return r()},children:Object(m.jsx)(se.b,{size:14})})}),Object(m.jsxs)(fe,{children:[Object(m.jsxs)(me,{children:[Object(m.jsxs)(ve,{children:[Object(m.jsx)(xe,{children:t.author.name}),Object(m.jsx)(we,{children:t.timeStr})]}),Object(m.jsxs)("div",{children:[Object(m.jsx)(ye,{children:t.type}),Object(m.jsxs)("div",{children:['"',t.content,'"']})]})]}),n.map((function(e){return Object(m.jsxs)(me,{children:[Object(m.jsxs)(ve,{children:[Object(m.jsx)(xe,{children:e.user.name}),Object(m.jsx)(we,{children:e.timeStr})]}),Object(m.jsx)("div",{children:e.text})]},e.id)}))]}),Object(m.jsx)(ke,{placeholder:"Reply...",value:s,onChange:function(e){return u(e.target.value)}}),Object(m.jsxs)(Se,{children:[Object(m.jsx)(De,{className:"accept",onClick:function(){return a()},children:Object(m.jsx)(se.a,{size:14})}),Object(m.jsx)(De,{className:"reject",onClick:function(){return c()},children:Object(m.jsx)(se.b,{size:14})})]})]})}var ue,de,be,he,je,ge=f.a.div(L||(L=Object(h.a)(["\n  background: #333;\n  color: white;\n  padding: 1rem;\n  position: relative;\n  font-size: 13px;\n  border-radius: 4px;\n"]))),fe=f.a.ul($||($=Object(h.a)(["\n  list-style: none;\n  margin: 0;\n  padding: 0;\n"]))),me=f.a.li(H||(H=Object(h.a)(["\n  & > div {\n    display: flex;\n    margin-bottom: 0.25rem;\n  }\n"]))),pe=f.a.div(Q||(Q=Object(h.a)(["\n  position: absolute;\n  right: -6px;\n  top: -6px;\n"]))),Oe=f.a.button(X||(X=Object(h.a)(["\n  align-items: center;\n  background: #333;\n  border: 0;\n  border-radius: 100%;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  padding: 0.25rem;\n"]))),ve=f.a.div(Y||(Y=Object(h.a)(["\n  display: flex;\n"]))),xe=f.a.div(Z||(Z=Object(h.a)(["\n  margin-right: 1rem;\n"]))),we=f.a.time(ee||(ee=Object(h.a)([""]))),ye=f.a.div(te||(te=Object(h.a)(["\n  margin-right: 1rem;\n"]))),ke=f.a.input(ne||(ne=Object(h.a)(["\n  background: #e4e4e4;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  height: 1rem;\n  margin-top: 0.5rem;\n  padding: 0.75rem 0.5rem;\n  width: 100%;\n"]))),Se=f.a.div(re||(re=Object(h.a)(["\n  display: flex;\n  margin-top: 1rem;\n  & > button + button {\n    margin-left: 1rem;\n  }\n"]))),De=f.a.button(ae||(ae=Object(h.a)(["\n  align-items: center;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  cursor: pointer;\n  display: flex;\n  padding: 0.25rem 0.75rem;\n  justify-content: center;\n  &.accept {\n    background: #16d816;\n  }\n  &.reject {\n    background: #ff3c3c;\n  }\n"]))),Me=new U.e("track-changes"),Ae=[["greenyellow","#ffa4a4"],["#10c727","#ff0707"],["#7adcb8","#f93aa2"]],Ce=function(){var e,t,n=document.createElement("div");return n.id="track-changes-comment-pop-up",null===(e=document.querySelector("body"))||void 0===e||e.appendChild(n),new U.d({key:Me,state:{init:function(e,t){return{changeSet:ie.a.create(t.doc),decorationSet:ce.b.empty,userColors:new Map,userID:"1"}},apply:function(e,t,n,r){if(e.getMeta("set-userID"))return Object(g.a)(Object(g.a)({},t),{},{userID:e.getMeta("set-userID")});var a,c=t.changeSet,i=t.userColors,o=t.userID;if(e.getMeta("accept-change")){var s=Number(e.getMeta("accept-change")),l=c.changes[s],u=n.doc.slice(l.fromB,l.toB),d=U.b.create({schema:n.schema,doc:c.startDoc});d=d.apply(d.tr.replaceWith(l.fromA,l.toA,u.content));var b=c.changes.filter((function(e,t){return t!==s}));a=new ie.a(Object(g.a)(Object(g.a)({},c.config),{},{doc:d.doc}),b)}else a=c.addSteps(e.doc,e.mapping.maps,{userID:o});i.has(o)||i.set(o,Ae[i.size]);var h=[],j=0,f=0;return a.changes.forEach((function(e,r){var c=e.fromB,i=e.inserted,o=e.deleted;i.forEach((function(n){var a=t.userColors.get(n.data.userID),i="background: ".concat(a?a[0]:"",";");h.push(ce.a.inline(c,e.toB,{style:i,"data-change-type":"insert","data-change-index":r.toString()})),c+=n.length,f+=n.length}));var s=0;o.forEach((function(c){var i=e.fromA+s,o=a.startDoc.textBetween(i,i+c.length),l=t.userColors.get(c.data.userID),u={style:"background: ".concat(l?l[1]:"",";"),"data-change-type":"delete","data-change-index":r.toString()};h.push(ce.a.widget(i+j+f,function(e,t){return function(n,r){var a=document.createElement("span");return a.textContent=e,Object.keys(t).forEach((function(e){a.setAttribute(e,t[e])})),a}}(o,u),{side:0,marks:[n.schema.marks.strikethrough.create()]})),j-=c.length,s+=c.length}))})),{changeSet:a,decorationSet:ce.b.create(e.doc,h),userColors:i,userID:o}}},props:{decorations:function(e){return this.getState(e).decorationSet},handleClickOn:function(e,r,a,c,i,o){var s=i.target?i.target:void 0,l=null===s||void 0===s?void 0:s.getAttribute("data-change-index"),d=null===s||void 0===s?void 0:s.getAttribute("data-change-type");if(s&&l&&d){var b=this.getState(e.state).changeSet,h=Number(l),j=b.changes[h],f=d,p="insert"===f?e.state.doc.textBetween(j.fromB,j.toB):b.startDoc.textBetween(j.fromA,j.toA);t=function(e,t,n){Object(u.render)(Object(m.jsx)(le,Object(g.a)({},n)),t);var r=Object(oe.a)(e,t,{placement:"bottom"});return{destroy:function(){Object(u.unmountComponentAtNode)(t),r.destroy()}}}(s,n,{change:{type:f,timeStr:"02-13-2019 11:20AM",content:p,author:{name:"John Doe"}},comments:[],onClose:function(){var e;null===(e=t)||void 0===e||e.destroy()},onAccept:function(){var n;e.dispatch(e.state.tr.setMeta("accept-change",h)),null===(n=t)||void 0===n||n.destroy()},onReject:function(){var n,r=b.startDoc.slice(j.fromA,j.toA);e.dispatch(e.state.tr.replaceWith(j.fromB,j.toB,r.content)),null===(n=t)||void 0===n||n.destroy()},onSubmitReply:function(e){return console.log("submitted",e),Promise.resolve()}})}return!1}}})};function Ne(e){var t=e.className,n=V().viewProvider,r=G(Me);return Object(m.jsx)(Ee,{className:t,children:null===r||void 0===r?void 0:r.changeSet.changes.map((function(e,t){return Object(m.jsxs)(Be,{children:[Object(m.jsxs)(_e,{children:[Object(m.jsx)("h4",{children:e.deleted.length>0?e.inserted.length>0?"Insertion + Deletion":"Deletion":"Insertion"}),Object(m.jsx)(Re,{onClick:function(){return function(e){var t=r.changeSet,a=t.changes[e],c=t.startDoc.slice(a.fromA,a.toA);n.view.dispatch(n.view.state.tr.replaceWith(a.fromB,a.toB,c.content))}(t)},children:"Revert"})]}),Object(m.jsxs)(Ie,{children:[Object(m.jsxs)("span",{className:"msg",children:["fromA: ",e.fromA]}),Object(m.jsxs)("span",{className:"msg",children:["toA: ",e.toA]}),Object(m.jsxs)("span",{className:"msg",children:["fromB: ",e.fromB]}),Object(m.jsxs)("span",{className:"msg",children:["toB: ",e.toB]})]})]},t)}))})}var Ee=f.a.ul(ue||(ue=Object(h.a)(["\n  display: flex;\n  flex-direction: column;\n  list-style: none;\n  padding: 0;\n  & > li + li {\n    margin-top: 1rem;\n  }\n"]))),Be=f.a.li(de||(de=Object(h.a)(["\n"]))),_e=f.a.div(be||(be=Object(h.a)(["\n  display: flex;\n  justify-content: space-between;\n  & > h4 {\n    margin: 0;\n    margin-right: 1rem;\n  }\n  & > button {\n    margin-right: 0.5rem;\n  }\n"]))),Ie=f.a.div(he||(he=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  & > .msg {\n    margin-right: 1rem;\n  }\n"]))),Re=f.a.button(je||(je=Object(h.a)(["\n  background: ",";\n"])),(function(e){return e.active&&"pink"})),Pe=n(108),ze=new(n(1).i)({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return["p",0]}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(e){var t=e;return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function(e){var t=e.attrs;return["img",{src:t.src,alt:t.alt,title:t.title}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(e){var t=e;return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function(e){var t=e.attrs;return["a",{href:t.href,title:t.title},0]}},italic:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em",0]}},bold:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return"normal"!=e.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function(){return["strong",0]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code",0]}},strikethrough:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"},{style:"text-decoration-line=line-through"}],toDOM:function(){return["s"]}}}});n(233),n(234),n(235);function Je(e){var t=e.className,n=void 0===t?"":t,r=Object(l.useRef)(null),a=Object(l.useRef)(null),c=V();function i(t){if(a.current){var n=a.current.state.apply(t);a.current.updateState(n),e.onEdit&&e.onEdit(n)}}return Object(l.useLayoutEffect)((function(){var t=U.b.create({schema:ze,plugins:Object(Pe.a)({schema:ze}).concat(Ce())}),n=r.current;return n&&(a.current=function(e,t){var n=new ce.c({mount:e},{state:t,dispatchTransaction:i});window&&(window.editorView=n);return n}(n,t),c.viewProvider.init(a.current),e.onEditorReady&&(null===e||void 0===e||e.onEditorReady(a.current))),function(){var e;null===(e=a.current)||void 0===e||e.destroy()}}),[]),Object(m.jsx)("div",{id:"example-editor",ref:r,className:n})}var Ve,We=function e(t){var n=this;if(Object(I.a)(this,e),this._view=void 0,this.jsonEditorState=void 0,this.localStorageKey=void 0,this.setEditorView=function(e){if(n._view=e,n.jsonEditorState){var t=U.b.fromJSON({schema:n._view.state.schema,plugins:n._view.state.plugins},n.jsonEditorState);n._view.updateState(t)}},this.syncCurrentEditorState=function(){var e;localStorage.setItem(n.localStorageKey,JSON.stringify(null===(e=n._view)||void 0===e?void 0:e.state.toJSON()))},this.localStorageKey=t,"undefined"!==typeof window){var r=localStorage.getItem(this.localStorageKey);if(r&&null!==r&&r.length>0){var a=JSON.parse(r);this.jsonEditorState=a}}};function Ke(){var e=Object(l.useMemo)((function(){return new We("track-changes")}),[]),t=Object(l.useMemo)((function(){return E()(e.syncCurrentEditorState,250)}),[]);return Object(m.jsxs)(J.Provider,{value:z(),children:[Object(m.jsx)(W,{}),Object(m.jsxs)(Te,{children:[Object(m.jsx)(Je,{onEdit:function(){t()},onEditorReady:function(t){e.setEditorView(t),Object(B.a)(t)}}),Object(m.jsx)(Ne,{className:"changes-list"})]})]})}var qe,Te=f.a.div(Ve||(Ve=Object(h.a)(["\n  display: flex;\n  width: 100%;\n  .changes-list {\n    margin-left: 1rem;\n  }\n"])));function Ue(){return Object(m.jsxs)(Fe,{children:[Object(m.jsx)(D,{}),Object(m.jsx)(Ke,{})]})}var Fe=f.a.div(qe||(qe=Object(h.a)([""]))),Ge=function(){return Object(m.jsx)(d.a,{basename:"/prosemirror-track-changes-example",children:Object(m.jsxs)(b.d,{children:[Object(m.jsx)(y,{exact:!0,path:"/",component:Ue}),Object(m.jsx)(b.a,{to:"/"})]})})};n(236);Object(u.render)(Object(m.jsx)(Ge,{}),document.getElementById("root"))}},[[237,1,2]]]);
//# sourceMappingURL=main.cfc83fa2.chunk.js.map