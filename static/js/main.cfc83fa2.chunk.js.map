{"version":3,"sources":["components/NavBar.tsx","components/WrappedRoute.tsx","components/PageHeader.tsx","pm/EditorViewProvider.ts","pm/Providers.ts","pm/EditorContext.ts","components/SelectUser.tsx","components/usePluginState.ts","pm/track-changes/CommentPopUp.tsx","pm/track-changes/track-changes-plugin.ts","components/ChangesList.tsx","pm/schema.ts","pm/PMEditor.tsx","components/EditorStore.ts","components/Editor.tsx","pages/FrontPage.tsx","routes.tsx","index.tsx"],"names":["NavBar","props","className","Container","Nav","Link","to","exact","activeClassName","styled","div","nav","NavLink","WrappedRoute","Component","component","rest","render","MainWrapper","MainContainer","main","PageHeader","href","EditorViewProvider","_view","view","this","Error","cmd","state","dispatch","createDefaultProviders","viewProvider","ReactEditorContext","createContext","useEditorContext","useContext","SelectUser","useState","userID","setUserID","handleSelectUser","id","tr","setMeta","Button","onClick","button","updatePluginWatcher","watcher","remove","newPlugins","plugins","filter","p","reconfigure","updateState","usePluginState","pluginKey","getState","setState","useEffect","plugin","Plugin","key","PluginKey","update","prevState","newPluginState","watcherPlugin","CommentPopUp","change","comments","onClose","onAccept","onReject","onSubmitReply","reply","setReply","CornerX","CloseIconBtn","size","List","Item","UserInfo","Name","author","name","Time","timeStr","ChangeType","type","content","map","c","user","text","ReplyInput","placeholder","value","onChange","e","target","Buttons","AcceptBtn","ul","li","time","input","trackChangesPluginKey","colorScheme","trackChangesPlugin","renderedPopper","popUpElement","document","createElement","querySelector","appendChild","init","config","changeSet","ChangeSet","create","doc","decorationSet","DecorationSet","empty","userColors","Map","apply","oldState","newState","getMeta","oldChangeSet","changeIndex","Number","changes","slice","fromB","toB","startState","EditorState","schema","startDoc","replaceWith","fromA","toA","_","i","addSteps","mapping","maps","has","set","decorations","allDeletionsLength","allInsertsLength","forEach","index","insertFrom","inserted","deleted","span","colors","get","data","style","push","Decoration","inline","toString","length","deletionsLength","start","textBetween","attrs","widget","getPos","element","textContent","Object","keys","setAttribute","deletedWidget","side","marks","strikethrough","handleClickOn","_pos","_node","_nodePos","event","_direct","el","undefined","dataChangeIndex","getAttribute","dataChangeType","changeType","container","popper","createPopper","placement","destroy","unmountComponentAtNode","renderCommentPopUp","console","log","Promise","resolve","ChangesList","trackChangesState","CommitItem","TitleWrapper","RevertBtn","idx","handleRevertChangeClick","Ranges","active","Schema","nodes","paragraph","group","parseDOM","tag","toDOM","blockquote","defining","horizontal_rule","heading","level","default","node","code_block","code","preserveWhitespace","image","src","alt","title","draggable","getAttrs","dom","hard_break","selectable","link","inclusive","italic","bold","fontWeight","test","PMEditor","editorViewRef","useRef","editorRef","ctx","dispatchTransaction","transaction","current","editorState","onEdit","useLayoutEffect","exampleSetup","concat","editorViewDOM","EditorView","mount","window","editorView","createEditorView","onEditorReady","ref","EditorStore","jsonEditorState","localStorageKey","setEditorView","fromJSON","syncCurrentEditorState","localStorage","setItem","JSON","stringify","toJSON","existing","getItem","stored","parse","Editor","editorStore","useMemo","debouncedSync","debounce","Provider","EditorWrapper","applyDevTools","FrontPage","Routes","basename","process","path","getElementById"],"mappings":"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","file":"static/js/main.cfc83fa2.chunk.js","sourcesContent":["import React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { RouteComponentProps } from 'react-router'\n\ninterface IProps extends RouteComponentProps<{}> {\n  className?: string\n}\n\nexport const NavBar = (props: IProps) => {\n  const { className} = props\n  return (\n    <Container className={className}>\n      <Nav>\n        <Link to=\"/\" exact activeClassName=\"current\">Front page</Link>\n      </Nav>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n`\nconst Nav = styled.nav`\n  align-items: center;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n`\nconst Link = styled(NavLink)`\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n`\n","import * as React from 'react'\nimport { Route, RouteProps, RouteComponentProps } from 'react-router'\nimport styled from 'styled-components'\n\nimport { NavBar } from './NavBar'\n\ntype ReactComponent = React.ComponentClass<any> | React.StatelessComponent<any>\n\ninterface IWrappedRoute extends RouteProps {\n  component: ReactComponent\n}\n\nconst renderNoMainContainerWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <Component {...props}/>\n  </MainWrapper>\n\nconst renderWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <MainContainer>\n      <Component {...props}/>\n    </MainContainer>\n  </MainWrapper>\n\nexport const NoMainContainerRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderNoMainContainerWrapper(component)}/>\n\nexport const WrappedRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderWrapper(component)}/>\n\nconst MainWrapper = styled.div`\n  min-height: 100vh;\n`\nconst MainContainer = styled.main`\n  margin: 40px auto 0 auto;\n  max-width: 800px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n`\n","import * as React from 'react'\nimport styled from 'styled-components'\n\ninterface IProps {\n  className?: string\n}\n\nexport function PageHeader(props: IProps) {\n  const { className } = props\n  return (\n    <Container className={className}>\n      <header>\n        <h1><a href=\"https://teemukoivisto.github.io/prosemirror-track-changes-example/\">\n          Track changes example</a></h1>\n        <p>With prosemirror-changeset</p>\n        <p><a href=\"https://github.com/TeemuKoivisto/prosemirror-track-changes-example\">Github repo</a></p>\n      </header>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import { EditorView } from 'prosemirror-view'\nimport { ExampleSchema } from './schema'\n\nimport { Command } from './editor-types'\n\nexport class EditorViewProvider {\n  _view?: EditorView<ExampleSchema>\n\n  init(view: EditorView<ExampleSchema>) {\n    this._view = view\n  }\n\n  get view(): EditorView<ExampleSchema> {\n    if (!this._view) {\n      throw Error('EditorViewProvider editorView accessed without editorView instance')\n    }\n    return this._view\n  }\n\n  execCommand(cmd: Command) {\n    cmd(this.view.state, this.view.dispatch)\n  }\n}","import { EditorViewProvider } from './EditorViewProvider'\n\nexport interface IProviders {\n  viewProvider: EditorViewProvider\n}\n\nexport const createDefaultProviders = (): IProviders => {\n  const viewProvider = new EditorViewProvider()\n  return {\n    viewProvider,\n  }\n}\n","import { createContext, useContext } from 'react'\nimport { IProviders, createDefaultProviders } from './Providers'\n\nexport type EditorContext = IProviders\n\nexport const ReactEditorContext = createContext<EditorContext>(createDefaultProviders())\n\nexport const useEditorContext = () => useContext(ReactEditorContext)\n","import React, { useState } from 'react'\nimport styled from 'styled-components'\n\nimport { useEditorContext } from 'pm/EditorContext'\n\ninterface IProps {\n  className?: string\n}\n\nexport function SelectUser(props: IProps) {\n  const { className } = props\n  const [userID, setUserID] = useState('1')\n  const { viewProvider } = useEditorContext()\n\n  function handleSelectUser(id: string) {\n    const view = viewProvider.view\n    view.dispatch(view.state.tr.setMeta('set-userID', id))\n    setUserID(id)\n  }\n  return (\n    <Container className={className}>\n      <div className=\"current-user\">\n        Current user: {userID}\n      </div>\n      <div>\n        <Button onClick={() => handleSelectUser('1')}>User 1</Button>\n        <Button onClick={() => handleSelectUser('2')}>User 2</Button>\n        <Button onClick={() => handleSelectUser('3')}>User 3</Button>\n      </div>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  align-items: center;\n  display: flex;\n  .current-user {\n    margin: 0.25rem 1rem 0.25rem 0;\n  }\n`\nconst Button = styled.button`\n  cursor: pointer;\n  & + & {\n    margin-left: 0.5rem;\n  }\n`","import { useState, useEffect } from 'react'\nimport { Plugin, PluginKey } from 'prosemirror-state'\nimport { EditorView } from 'prosemirror-view'\n\nimport { ExampleSchema } from 'pm/schema'\n\nimport { useEditorContext } from 'pm/EditorContext'\n\n// Modified from https://github.com/bangle-io/bangle.dev/blob/master/react/hooks.jsx\n\nconst updatePluginWatcher = (view: EditorView, watcher: Plugin<any, ExampleSchema>, remove = false) => {\n  let state = view.state\n\n  const newPlugins = remove\n    ? state.plugins.filter((p) => p !== watcher)\n    : [...state.plugins, watcher]\n\n  state = state.reconfigure({\n    plugins: newPlugins,\n  })\n\n  view.updateState(state)\n}\n\nexport function usePluginState(pluginKey: PluginKey) {\n  const { viewProvider } = useEditorContext()\n  const [state, setState] = useState(viewProvider._view ? pluginKey.getState(viewProvider._view.state) : null)\n\n  useEffect(() => {\n    const view = viewProvider._view\n    if (!view) return\n    const plugin = watcherPlugin(pluginKey, setState)\n    updatePluginWatcher(view, plugin)\n    return () => {\n      updatePluginWatcher(view, plugin, true)\n    }\n  }, [viewProvider._view, pluginKey])\n\n  return state\n}\n\nexport function watcherPlugin(pluginKey: PluginKey, setState: (newState: any) => void) {\n  return new Plugin({\n    // @ts-ignore\n    key: new PluginKey(`withPluginState_${pluginKey.key}`),\n    view() {\n      return {\n        update(view: EditorView, prevState: any) {\n          const { state } = view\n          if (prevState === state) {\n            return\n          }\n          const newPluginState = pluginKey.getState(state)\n          if (newPluginState !== pluginKey.getState(prevState)) {\n            setState(newPluginState)\n          }\n        },\n      }\n    },\n  })\n}","import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport { render, unmountComponentAtNode } from 'react-dom'\nimport { createPopper } from '@popperjs/core'\n\nimport { FiCheck, FiX } from 'react-icons/fi'\n\nimport { Comment, TrackedChange } from './types'\n\nexport function renderCommentPopUp(target: HTMLElement, container: HTMLElement, props: Props) {\n  render(<CommentPopUp {...props}/>, container)\n  const popper = createPopper(target, container, {\n    placement: 'bottom',\n  })\n  return {\n    destroy() {\n      unmountComponentAtNode(container)\n      popper.destroy()\n    }\n  }\n}\n\ninterface Props {\n  change: TrackedChange\n  comments: Comment[]\n  onClose: () => void\n  onAccept: () => void\n  onReject: () => void\n  onSubmitReply: (text: string) => Promise<void>\n}\n\nfunction CommentPopUp(props: Props) {\n  const { change, comments, onClose, onAccept, onReject, onSubmitReply} = props\n  const [reply, setReply] = useState('')\n  function handleKeyPress(e: React.KeyboardEvent) {\n\n  }\n  return (\n    <Container>\n      <CornerX>\n        <CloseIconBtn onClick={() => onClose()}><FiX size={14}/></CloseIconBtn>\n      </CornerX>\n      <List>\n        <Item>\n          <UserInfo>\n            <Name>{change.author.name}</Name>\n            <Time>{change.timeStr}</Time>\n          </UserInfo>\n          <div>\n            <ChangeType>{change.type}</ChangeType>\n            <div>\"{change.content}\"</div>\n          </div>\n        </Item>\n        { comments.map(c =>          \n        <Item key={c.id}>\n          <UserInfo>\n            <Name>{c.user.name}</Name>\n            <Time>{c.timeStr}</Time>\n          </UserInfo>\n          <div>\n            {c.text}\n          </div>\n        </Item>\n        )}\n      </List>\n      <ReplyInput placeholder=\"Reply...\" value={reply} onChange={e => setReply(e.target.value)}/>\n      <Buttons>\n        <AcceptBtn className=\"accept\" onClick={() => onAccept()}>\n          <FiCheck size={14}/>\n        </AcceptBtn>\n        <AcceptBtn className=\"reject\" onClick={() => onReject()}>\n          <FiX size={14}/>\n        </AcceptBtn>\n      </Buttons>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  background: #333;\n  color: white;\n  padding: 1rem;\n  position: relative;\n  font-size: 13px;\n  border-radius: 4px;\n`\nconst List = styled.ul`\n  list-style: none;\n  margin: 0;\n  padding: 0;\n`\nconst Item = styled.li`\n  & > div {\n    display: flex;\n    margin-bottom: 0.25rem;\n  }\n`\nconst CornerX = styled.div`\n  position: absolute;\n  right: -6px;\n  top: -6px;\n`\nconst CloseIconBtn = styled.button`\n  align-items: center;\n  background: #333;\n  border: 0;\n  border-radius: 100%;\n  color: white;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  padding: 0.25rem;\n`\nconst UserInfo = styled.div`\n  display: flex;\n`\nconst Name = styled.div`\n  margin-right: 1rem;\n`\nconst Time = styled.time``\nconst ChangeType = styled.div`\n  margin-right: 1rem;\n`\nconst ReplyInput = styled.input`\n  background: #e4e4e4;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  height: 1rem;\n  margin-top: 0.5rem;\n  padding: 0.75rem 0.5rem;\n  width: 100%;\n`\nconst Buttons = styled.div`\n  display: flex;\n  margin-top: 1rem;\n  & > button + button {\n    margin-left: 1rem;\n  }\n`\nconst AcceptBtn = styled.button`\n  align-items: center;\n  border: 0;\n  border-radius: 2px;\n  color: #222;\n  cursor: pointer;\n  display: flex;\n  padding: 0.25rem 0.75rem;\n  justify-content: center;\n  &.accept {\n    background: #16d816;\n  }\n  &.reject {\n    background: #ff3c3c;\n  }\n`\n","import { EditorView } from 'prosemirror-view'\nimport { EditorState, Plugin, PluginKey } from 'prosemirror-state'\nimport { Decoration, DecorationSet } from 'prosemirror-view'\nimport { Change, ChangeSet } from 'prosemirror-changeset'\n\nimport { renderCommentPopUp } from './CommentPopUp'\n\nimport { ExampleSchema } from '../schema'\nimport { TrackedChangeType } from './types'\n\nexport interface TrackChangesState {\n  changeSet: ChangeSet\n  decorationSet: DecorationSet<ExampleSchema>\n  userColors: Map<string, [string, string]>\n  userID: string\n}\n\nexport const trackChangesPluginKey = new PluginKey<TrackChangesState, ExampleSchema>('track-changes')\n\nconst colorScheme: [string, string][] = [\n  ['greenyellow', '#ffa4a4'],\n  ['#10c727', '#ff0707'],\n  ['#7adcb8', '#f93aa2']\n]\n\nconst deletedWidget = (content: string, attrs: {[key: string]: string}) => (view: EditorView, getPos: () => number) => {\n  const element = document.createElement('span')\n  element.textContent = content\n  Object.keys(attrs).forEach((key) => {\n    element.setAttribute(key, attrs[key])\n  })\n  return element\n}\n\nexport const trackChangesPlugin = () => {\n\n  const popUpElement = document.createElement('div')\n  popUpElement.id = 'track-changes-comment-pop-up'\n  document.querySelector('body')?.appendChild(popUpElement)\n  let renderedPopper: {\n    destroy: () => void\n  } | undefined\n\n  return new Plugin<TrackChangesState, ExampleSchema>({\n    key: trackChangesPluginKey,\n    state: {\n      init(config, state) {\n        return {\n          changeSet: ChangeSet.create(state.doc),\n          decorationSet: DecorationSet.empty,\n          userColors: new Map(),\n          userID: '1',\n        }\n      },\n\n      apply(tr, value, oldState, newState) {\n        if (tr.getMeta('set-userID')) {\n          return { ...value, userID: tr.getMeta('set-userID') }\n        }\n        const { changeSet: oldChangeSet, userColors, userID } = value\n        let changeSet: ChangeSet\n        if (tr.getMeta('accept-change')) {\n          const changeIndex = Number(tr.getMeta('accept-change'))\n          const change = oldChangeSet.changes[changeIndex]\n          const slice = oldState.doc.slice(change.fromB, change.toB)\n          let startState = EditorState.create({\n            schema: oldState.schema,\n            doc: oldChangeSet.startDoc,\n          })\n          startState = startState.apply(startState.tr.replaceWith(change.fromA, change.toA, slice.content))\n          // TODO The changes after the accepted change should be updated\n          // const beforeChanges = oldChangeSet.changes.slice(0, changeIndex)\n          // const afterChanges = oldChangeSet.changes.slice(changeIndex + 1).map(c => {\n          //   return c\n          //   // const fromA = c.fromA\n          //   // const toA = c.toA\n          //   // // const fromA = c.fromA - change.lenA + change.lenB\n          //   // // const toA = c.toA - change.lenA + change.lenB\n          //   // return new Change(fromA, toA, change.fromB, change.toB, change.deleted, change.inserted)\n          // })\n          // const changes = [...beforeChanges, ...afterChanges]\n          const changes = oldChangeSet.changes.filter((_, i) => i !== changeIndex)\n          // @ts-ignore\n          changeSet = new ChangeSet({ ...oldChangeSet.config, doc: startState.doc }, changes)\n        } else {\n          changeSet = oldChangeSet.addSteps(tr.doc, tr.mapping.maps, { userID })\n        }\n\n        if (!userColors.has(userID)) {\n          userColors.set(userID, colorScheme[userColors.size])\n        }\n        const decorations: Decoration[] = []\n        let allDeletionsLength = 0\n        let allInsertsLength = 0\n\n        changeSet.changes.forEach((change, index) => {\n          let insertFrom = change.fromB\n          const { inserted, deleted } = change        \n          inserted.forEach((span) => {\n            const colors = value.userColors.get(span.data.userID)\n            const style = `background: ${colors ? colors[0] : ''};`\n            decorations.push(Decoration.inline(insertFrom, change.toB, {\n              style,\n              'data-change-type': 'insert',\n              'data-change-index': index.toString(),\n            }))\n            // @ts-ignore\n            insertFrom += span.length\n            // @ts-ignore\n            allInsertsLength += span.length\n          })\n\n          let deletionsLength = 0\n          deleted.forEach((span) => {\n            const start = change.fromA + deletionsLength\n            // @ts-ignore\n            const content = changeSet.startDoc.textBetween(start, start + span.length)\n            const colors = value.userColors.get(span.data.userID)\n            const style = `background: ${colors ? colors[1] : ''};`\n            const attrs = {\n              style,\n              'data-change-type': 'delete',\n              'data-change-index': index.toString(),\n            }\n            decorations.push(\n              Decoration.widget(start + allDeletionsLength + allInsertsLength, deletedWidget(content, attrs), {\n                side: 0,\n                marks: [oldState.schema.marks.strikethrough.create()],\n              })\n            )\n            // @ts-ignore\n            allDeletionsLength -= span.length\n            // @ts-ignore\n            deletionsLength += span.length\n          })\n        })\n        return {\n          changeSet,\n          decorationSet: DecorationSet.create(tr.doc, decorations),\n          userColors,\n          userID,\n        }\n      },\n    },\n    props: {\n      decorations(state) {\n        return this.getState(state).decorationSet\n      },\n      handleClickOn(view, _pos, _node, _nodePos, event, _direct) {\n        const el = event.target ? event.target as HTMLElement : undefined\n        const dataChangeIndex = el?.getAttribute('data-change-index')\n        const dataChangeType = el?.getAttribute('data-change-type')\n\n        if (el && dataChangeIndex && dataChangeType) {\n          const changeSet = this.getState(view.state).changeSet\n          const changeIndex = Number(dataChangeIndex)\n          const change = changeSet.changes[changeIndex]\n          const changeType = dataChangeType as TrackedChangeType\n          const content = changeType === 'insert' ? view.state.doc.textBetween(change.fromB, change.toB)\n            : changeSet.startDoc.textBetween(change.fromA, change.toA)\n          const props = {\n            change: {\n              type: changeType,\n              timeStr: '02-13-2019 11:20AM',\n              content,\n              author: {\n                name: 'John Doe'\n              }\n            },\n            comments: [],\n            onClose: () => {\n              renderedPopper?.destroy()\n            },\n            onAccept: () => {\n              view.dispatch(view.state.tr.setMeta('accept-change', changeIndex))\n              renderedPopper?.destroy()\n            },\n            onReject: () => {\n              const slice = changeSet.startDoc.slice(change.fromA, change.toA)\n              view.dispatch(view.state.tr.replaceWith(change.fromB, change.toB, slice.content))\n              renderedPopper?.destroy()\n            },\n            onSubmitReply: (text: string) => {\n              console.log('submitted', text)\n              return Promise.resolve()\n            }\n          }\n          renderedPopper = renderCommentPopUp(el, popUpElement, props)\n        }\n        return false\n      }\n    },\n  })\n}","import React from 'react'\nimport styled from 'styled-components'\nimport { Change } from 'prosemirror-changeset'\n\nimport { useEditorContext } from 'pm/EditorContext'\nimport { usePluginState } from './usePluginState'\n\nimport { TrackChangesState, trackChangesPluginKey } from 'pm/track-changes/track-changes-plugin'\n\ninterface IProps {\n  className?: string\n}\n\nexport function ChangesList(props: IProps) {\n  const { className } = props\n  const { viewProvider } = useEditorContext()\n  const trackChangesState: TrackChangesState = usePluginState(trackChangesPluginKey)\n\n  function handleRevertChangeClick(idx: number) {\n    const changeSet = trackChangesState.changeSet\n    const change = changeSet.changes[idx]\n    const slice = changeSet.startDoc.slice(change.fromA, change.toA)\n    viewProvider.view.dispatch(viewProvider.view.state.tr.replaceWith(change.fromB, change.toB, slice.content))\n  }\n\n  return (\n    <List className={className}>\n      { trackChangesState?.changeSet.changes.map((c: Change, i: number) =>\n      <CommitItem\n        key={i}\n      >\n        <TitleWrapper>\n          <h4>{ c.deleted.length > 0 ? c.inserted.length > 0 ? 'Insertion + Deletion' : 'Deletion' : 'Insertion'}</h4>\n          <RevertBtn\n            onClick={() => handleRevertChangeClick(i)}\n          >\n            Revert\n          </RevertBtn>\n        </TitleWrapper>\n        <Ranges>\n          <span className=\"msg\">fromA: {c.fromA}</span>\n          <span className=\"msg\">toA: {c.toA}</span>\n          <span className=\"msg\">fromB: {c.fromB}</span>\n          <span className=\"msg\">toB: {c.toB}</span>\n        </Ranges>\n      </CommitItem>\n      )}\n    </List>\n  )\n}\n\nconst List = styled.ul`\n  display: flex;\n  flex-direction: column;\n  list-style: none;\n  padding: 0;\n  & > li + li {\n    margin-top: 1rem;\n  }\n`\nconst CommitItem = styled.li`\n`\nconst TitleWrapper = styled.div`\n  display: flex;\n  justify-content: space-between;\n  & > h4 {\n    margin: 0;\n    margin-right: 1rem;\n  }\n  & > button {\n    margin-right: 0.5rem;\n  }\n`\nconst Ranges = styled.div`\n  align-items: center;\n  display: flex;\n  & > .msg {\n    margin-right: 1rem;\n  }\n`\nconst RevertBtn = styled.button<{ active?: boolean }>`\n  background: ${({ active }) => active && 'pink'};\n`\n","import { Schema } from 'prosemirror-model'\n\nexport type Marks = 'bold' | 'code' | 'italic' | 'link' | 'strikethrough'\nexport type Nodes =\n  | 'blockquote'\n  | 'code_block'\n  | 'doc'\n  | 'hard_break'\n  | 'heading'\n  | 'horizontal_rule'\n  | 'image'\n  | 'paragraph'\n  | 'text'\nexport type ExampleSchema = Schema<Nodes, Marks>\n\nexport const schema: ExampleSchema = new Schema<Nodes, Marks>({\n  nodes: {\n    // :: NodeSpec The top level document node.\n    doc: {\n      content: 'block+',\n    },\n\n    // :: NodeSpec A plain paragraph textblock. Represented in the DOM\n    // as a `<p>` element.\n    paragraph: {\n      content: 'inline*',\n      group: 'block',\n      parseDOM: [{ tag: 'p' }],\n      toDOM() {\n        return ['p', 0]\n      },\n    },\n\n    // :: NodeSpec A blockquote (`<blockquote>`) wrapping one or more blocks.\n    blockquote: {\n      content: 'block+',\n      group: 'block',\n      defining: true,\n      parseDOM: [{ tag: 'blockquote' }],\n      toDOM() {\n        return ['blockquote', 0]\n      },\n    },\n\n    // :: NodeSpec A horizontal rule (`<hr>`).\n    horizontal_rule: {\n      group: 'block',\n      parseDOM: [{ tag: 'hr' }],\n      toDOM() {\n        return ['hr']\n      },\n    },\n\n    // :: NodeSpec A heading textblock, with a `level` attribute that\n    // should hold the number 1 to 6. Parsed and serialized as `<h1>` to\n    // `<h6>` elements.\n    heading: {\n      attrs: { level: { default: 1 } },\n      content: 'inline*',\n      group: 'block',\n      defining: true,\n      parseDOM: [\n        { tag: 'h1', attrs: { level: 1 } },\n        { tag: 'h2', attrs: { level: 2 } },\n        { tag: 'h3', attrs: { level: 3 } },\n        { tag: 'h4', attrs: { level: 4 } },\n        { tag: 'h5', attrs: { level: 5 } },\n        { tag: 'h6', attrs: { level: 6 } },\n      ],\n      toDOM(node) {\n        return ['h' + node.attrs.level, 0]\n      },\n    },\n\n    // :: NodeSpec A code listing. Disallows marks or non-text inline\n    // nodes by default. Represented as a `<pre>` element with a\n    // `<code>` element inside of it.\n    code_block: {\n      content: 'text*',\n      marks: '',\n      group: 'block',\n      code: true,\n      defining: true,\n      parseDOM: [{ tag: 'pre', preserveWhitespace: 'full' }],\n      toDOM() {\n        return ['pre', ['code', 0]]\n      },\n    },\n\n    // :: NodeSpec The text node.\n    text: {\n      group: 'inline',\n    },\n\n    // :: NodeSpec An inline image (`<img>`) node. Supports `src`,\n    // `alt`, and `href` attributes. The latter two default to the empty\n    // string.\n    image: {\n      inline: true,\n      attrs: {\n        src: {},\n        alt: { default: null },\n        title: { default: null },\n      },\n      group: 'inline',\n      draggable: true,\n      parseDOM: [\n        {\n          tag: 'img[src]',\n          getAttrs(p) {\n            const dom = p as HTMLElement\n            return {\n              src: dom.getAttribute('src'),\n              title: dom.getAttribute('title'),\n              alt: dom.getAttribute('alt'),\n            }\n          },\n        },\n      ],\n      toDOM(node) {\n        const { src, alt, title } = node.attrs\n        return ['img', { src, alt, title }]\n      },\n    },\n\n    // :: NodeSpec A hard line break, represented in the DOM as `<br>`.\n    hard_break: {\n      inline: true,\n      group: 'inline',\n      selectable: false,\n      parseDOM: [{ tag: 'br' }],\n      toDOM() {\n        return ['br']\n      },\n    },\n  },\n  marks: {\n    // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n    // defaults to the empty string. Rendered and parsed as an `<a>`\n    // element.\n    link: {\n      attrs: {\n        href: {},\n        title: { default: null },\n      },\n      inclusive: false,\n      parseDOM: [\n        {\n          tag: 'a[href]',\n          getAttrs(p) {\n            const dom = p as HTMLElement\n            return {\n              href: dom.getAttribute('href'),\n              title: dom.getAttribute('title'),\n            }\n          },\n        },\n      ],\n      toDOM(node) {\n        const { href, title } = node.attrs\n        return ['a', { href, title }, 0]\n      },\n    },\n\n    // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n    // Has parse rules that also match `<i>` and `font-style: italic`.\n    italic: {\n      parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n      toDOM() {\n        return ['em', 0]\n      },\n    },\n\n    // :: MarkSpec A strong mark. Rendered as `<strong>`, parse rules\n    // also match `<b>` and `font-weight: bold`.\n    bold: {\n      parseDOM: [\n        { tag: 'strong' },\n        // This works around a Google Docs misbehavior where\n        // pasted content will be inexplicably wrapped in `<b>`\n        // tags with a font-weight normal.\n        {\n          tag: 'b',\n          getAttrs: (p) => {\n            const node = p as HTMLElement\n            return node.style.fontWeight != 'normal' && null\n          },\n        },\n        {\n          style: 'font-weight',\n          getAttrs: (p) => {\n            const value = p as string\n            return /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null\n          },\n        },\n      ],\n      toDOM() {\n        return ['strong', 0]\n      },\n    },\n\n    // :: MarkSpec Code font mark. Represented as a `<code>` element.\n    code: {\n      parseDOM: [{ tag: 'code' }],\n      toDOM() {\n        return ['code', 0]\n      },\n    },\n\n    strikethrough: {\n      parseDOM: [\n        { tag: 's' },\n        { tag: 'strike' },\n        { style: 'text-decoration=line-through' },\n        { style: 'text-decoration-line=line-through' },\n      ],\n      toDOM: () => ['s'],\n    }\n  },\n})\n","import React, { useEffect, useLayoutEffect, useRef } from 'react'\nimport { EditorView } from 'prosemirror-view'\nimport { EditorState, Transaction } from 'prosemirror-state'\nimport { exampleSetup } from 'prosemirror-example-setup'\n\nimport { schema } from './schema'\nimport { trackChangesPlugin } from './track-changes/track-changes-plugin'\n\nimport { useEditorContext } from './EditorContext'\n\nimport './editor.css'\nimport './prosemirror-example-setup.css'\nimport './menu.css'\n\ninterface EditorProps {\n  className?: string\n  onEditorReady?: (view: EditorView) => void\n  onEdit?: (state: EditorState) => void\n}\n\nexport function PMEditor(props: EditorProps) {\n  const { className = '' } = props\n  const editorViewRef = useRef(null)\n  const editorRef = useRef<EditorView | null>(null)\n  const ctx = useEditorContext()\n\n  useLayoutEffect(() => {\n    const state = createEditorState()\n    const editorViewDOM = editorViewRef.current\n    if (editorViewDOM) {\n      editorRef.current = createEditorView(editorViewDOM, state)\n      ctx.viewProvider.init(editorRef.current)\n      props.onEditorReady && props?.onEditorReady(editorRef.current)\n    }\n    return () => {\n      editorRef.current?.destroy()\n    }\n  }, [])\n\n  function createEditorState() {\n    return EditorState.create({\n      schema,\n      plugins: exampleSetup({ schema }).concat(\n        trackChangesPlugin(),\n      ),\n    })\n  }\n\n  function createEditorView(element: HTMLDivElement, state: EditorState) {\n    const view = new EditorView({ mount: element }, {\n      state,\n      dispatchTransaction,\n    })\n    // @ts-ignore\n    if (window) window.editorView = view\n    return view\n  }\n\n  function dispatchTransaction(transaction: Transaction) {\n    if (!editorRef.current) {\n      return\n    }\n    const editorState = editorRef.current.state.apply(transaction)\n    editorRef.current.updateState(editorState)\n    if (props.onEdit) {\n      props.onEdit(editorState)\n    }\n  }\n\n  return (\n    <div id=\"example-editor\" ref={editorViewRef} className={className}/>\n  )\n}\n","import { EditorView } from 'prosemirror-view'\nimport { EditorState } from 'prosemirror-state'\nimport { ExampleSchema } from 'pm/schema'\n\nexport class EditorStore {\n\n  _view?: EditorView<ExampleSchema>\n  jsonEditorState?: {[key: string]: any}\n  localStorageKey: string\n\n  constructor(key: string) {\n    this.localStorageKey = key\n    if (typeof window !== 'undefined') {\n      const existing = localStorage.getItem(this.localStorageKey)\n      if (existing && existing !== null && existing.length > 0) {\n        let stored = JSON.parse(existing)\n        this.jsonEditorState = stored\n      }\n    }\n  }\n\n  setEditorView = (view: EditorView) => {\n    this._view = view\n    if (this.jsonEditorState) {\n      const state = EditorState.fromJSON(\n        {\n          schema: this._view.state.schema,\n          plugins: this._view.state.plugins,\n        },\n        this.jsonEditorState\n      )\n      this._view.updateState(state)\n    }\n  }\n\n  syncCurrentEditorState = () => {\n    localStorage.setItem(this.localStorageKey, JSON.stringify(this._view?.state.toJSON()))\n  }\n}","import React, { useMemo } from 'react'\nimport styled from 'styled-components'\nimport debounce from 'lodash.debounce'\n\nimport { EditorView } from 'prosemirror-view'\nimport { applyDevTools } from 'prosemirror-dev-tools'\n\nimport { SelectUser } from './SelectUser'\nimport { ChangesList } from './ChangesList'\n\nimport { PMEditor } from 'pm/PMEditor'\nimport { EditorStore } from './EditorStore'\nimport { ReactEditorContext } from 'pm/EditorContext'\nimport { createDefaultProviders } from 'pm/Providers'\n\nexport function Editor() {\n  const editorStore = useMemo(() => new EditorStore('track-changes'), [])\n  const debouncedSync = useMemo(() => debounce(editorStore.syncCurrentEditorState, 250), [])\n\n  function handleEdit() {\n    debouncedSync()\n  }\n  function handleEditorReady(view: EditorView) {\n    editorStore.setEditorView(view)\n    applyDevTools(view)\n  }\n  return (\n    <ReactEditorContext.Provider value={createDefaultProviders()}>\n      <SelectUser/>\n      <EditorWrapper>\n        <PMEditor\n          onEdit={handleEdit}\n          onEditorReady={handleEditorReady}\n        />\n        <ChangesList className=\"changes-list\"/>\n      </EditorWrapper>\n    </ReactEditorContext.Provider>\n  )\n}\n\nconst EditorWrapper = styled.div`\n  display: flex;\n  width: 100%;\n  .changes-list {\n    margin-left: 1rem;\n  }\n`","import React from 'react'\nimport styled from 'styled-components'\n\nimport { PageHeader } from '../components/PageHeader'\nimport { Editor } from '../components/Editor'\n\nexport function FrontPage() {\n  return (\n    <Container>\n      <PageHeader/>\n      <Editor/>\n    </Container>\n  )\n}\n\nconst Container = styled.div``\n","import * as React from 'react'\nimport { BrowserRouter, Redirect, Switch } from 'react-router-dom'\n\nimport { WrappedRoute } from './components/WrappedRoute'\n\nimport { FrontPage } from './pages/FrontPage'\n\nexport const Routes = () => (\n  <BrowserRouter basename={process.env.PUBLIC_URL}>\n    <Switch>\n      <WrappedRoute exact path=\"/\" component={FrontPage}/>\n      <Redirect to=\"/\" />\n    </Switch>\n  </BrowserRouter>\n)\n","import * as React from 'react'\nimport { render } from 'react-dom'\n\nimport { Routes } from './routes'\n\nimport './index.css'\n\nrender(\n  <Routes />,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}