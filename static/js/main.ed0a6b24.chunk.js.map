{"version":3,"sources":["components/NavBar.tsx","components/WrappedRoute.tsx","components/PageHeader.tsx","pm/schema.ts","pm/track-changes.ts","pm/PMEditor.tsx","components/EditorStore.ts","components/Editor.tsx","pages/FrontPage.tsx","routes.tsx","index.tsx"],"names":["NavBar","props","className","Container","Nav","Link","to","exact","activeClassName","styled","div","nav","NavLink","WrappedRoute","Component","component","rest","render","MainWrapper","MainContainer","main","PageHeader","href","schema","Schema","nodes","doc","content","paragraph","group","parseDOM","tag","toDOM","blockquote","defining","horizontal_rule","heading","attrs","level","default","node","code_block","marks","code","preserveWhitespace","text","image","inline","src","alt","title","draggable","getAttrs","p","dom","getAttribute","hard_break","selectable","link","inclusive","italic","style","bold","fontWeight","test","strikethrough","trackChangesPluginKey","PluginKey","trackChangesPlugin","Plugin","key","state","init","config","changeSet","ChangeSet","create","decorationSet","DecorationSet","empty","apply","tr","value","oldState","newState","addSteps","mapping","maps","steps","map","s","ReplaceStep","slice","size","textBetween","from","spanData","decorations","allDeletionsLength","allInsertsLength","changes","forEach","change","insertFrom","fromB","inserted","span","push","Decoration","toB","class","length","deleted","reduce","acc","cur","idx","Span","join","a","b","startDoc","fromA","widget","view","getPos","element","document","createElement","textContent","classList","add","deletedWidget","side","this","getState","PMEditor","editorViewRef","useRef","editorRef","dispatchTransaction","transaction","current","editorState","updateState","onEdit","useLayoutEffect","EditorState","plugins","exampleSetup","concat","editorViewDOM","EditorView","mount","window","editorView","createEditorView","onEditorReady","destroy","id","ref","EditorStore","currentEditorState","localStorageKey","setEditorView","fromJSON","syncCurrentEditorState","toJSON","localStorage","setItem","JSON","stringify","existing","getItem","stored","parse","Editor","editorStore","useMemo","debouncedSync","debounce","applyDevTools","FrontPage","Routes","basename","process","path","getElementById"],"mappings":"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","file":"static/js/main.ed0a6b24.chunk.js","sourcesContent":["import React from 'react'\nimport { NavLink } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { RouteComponentProps } from 'react-router'\n\ninterface IProps extends RouteComponentProps<{}> {\n  className?: string\n}\n\nexport const NavBar = (props: IProps) => {\n  const { className} = props\n  return (\n    <Container className={className}>\n      <Nav>\n        <Link to=\"/\" exact activeClassName=\"current\">Front page</Link>\n      </Nav>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n`\nconst Nav = styled.nav`\n  align-items: center;\n  color: #fff;\n  display: flex;\n  justify-content: space-between;\n`\nconst Link = styled(NavLink)`\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n`\n","import * as React from 'react'\nimport { Route, RouteProps, RouteComponentProps } from 'react-router'\nimport styled from 'styled-components'\n\nimport { NavBar } from './NavBar'\n\ntype ReactComponent = React.ComponentClass<any> | React.StatelessComponent<any>\n\ninterface IWrappedRoute extends RouteProps {\n  component: ReactComponent\n}\n\nconst renderNoMainContainerWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <Component {...props}/>\n  </MainWrapper>\n\nconst renderWrapper = (Component: ReactComponent) => (props: RouteComponentProps<any>) =>\n  <MainWrapper>\n    <NavBar {...props}/>\n    <MainContainer>\n      <Component {...props}/>\n    </MainContainer>\n  </MainWrapper>\n\nexport const NoMainContainerRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderNoMainContainerWrapper(component)}/>\n\nexport const WrappedRoute = ({ component, ...rest } : IWrappedRoute) =>\n  <Route {...rest} render={renderWrapper(component)}/>\n\nconst MainWrapper = styled.div`\n  min-height: 100vh;\n`\nconst MainContainer = styled.main`\n  margin: 40px auto 0 auto;\n  max-width: 680px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n`\n","import * as React from 'react'\nimport styled from 'styled-components'\n\ninterface IProps {\n  className?: string\n}\n\nexport function PageHeader(props: IProps) {\n  const { className } = props\n  return (\n    <Container className={className}>\n      <header>\n        <h1><a href=\"https://teemukoivisto.github.io/prosemirror-track-changes-example/\">\n          Track changes example</a></h1>\n        <p>With prosemirror-changeset</p>\n        <p><a href=\"https://github.com/TeemuKoivisto/prosemirror-track-changes-example\">Github repo</a></p>\n      </header>\n    </Container>\n  )\n}\n\nconst Container = styled.div`\n`\n","import { Schema } from 'prosemirror-model'\n\nexport type Marks = 'bold' | 'code' | 'italic' | 'link' | 'strikethrough'\nexport type Nodes =\n  | 'blockquote'\n  | 'code_block'\n  | 'doc'\n  | 'hard_break'\n  | 'heading'\n  | 'horizontal_rule'\n  | 'image'\n  | 'paragraph'\n  | 'text'\nexport type ExampleSchema = Schema<Nodes, Marks>\n\nexport const schema: ExampleSchema = new Schema<Nodes, Marks>({\n  nodes: {\n    // :: NodeSpec The top level document node.\n    doc: {\n      content: 'block+',\n    },\n\n    // :: NodeSpec A plain paragraph textblock. Represented in the DOM\n    // as a `<p>` element.\n    paragraph: {\n      content: 'inline*',\n      group: 'block',\n      parseDOM: [{ tag: 'p' }],\n      toDOM() {\n        return ['p', 0]\n      },\n    },\n\n    // :: NodeSpec A blockquote (`<blockquote>`) wrapping one or more blocks.\n    blockquote: {\n      content: 'block+',\n      group: 'block',\n      defining: true,\n      parseDOM: [{ tag: 'blockquote' }],\n      toDOM() {\n        return ['blockquote', 0]\n      },\n    },\n\n    // :: NodeSpec A horizontal rule (`<hr>`).\n    horizontal_rule: {\n      group: 'block',\n      parseDOM: [{ tag: 'hr' }],\n      toDOM() {\n        return ['hr']\n      },\n    },\n\n    // :: NodeSpec A heading textblock, with a `level` attribute that\n    // should hold the number 1 to 6. Parsed and serialized as `<h1>` to\n    // `<h6>` elements.\n    heading: {\n      attrs: { level: { default: 1 } },\n      content: 'inline*',\n      group: 'block',\n      defining: true,\n      parseDOM: [\n        { tag: 'h1', attrs: { level: 1 } },\n        { tag: 'h2', attrs: { level: 2 } },\n        { tag: 'h3', attrs: { level: 3 } },\n        { tag: 'h4', attrs: { level: 4 } },\n        { tag: 'h5', attrs: { level: 5 } },\n        { tag: 'h6', attrs: { level: 6 } },\n      ],\n      toDOM(node) {\n        return ['h' + node.attrs.level, 0]\n      },\n    },\n\n    // :: NodeSpec A code listing. Disallows marks or non-text inline\n    // nodes by default. Represented as a `<pre>` element with a\n    // `<code>` element inside of it.\n    code_block: {\n      content: 'text*',\n      marks: '',\n      group: 'block',\n      code: true,\n      defining: true,\n      parseDOM: [{ tag: 'pre', preserveWhitespace: 'full' }],\n      toDOM() {\n        return ['pre', ['code', 0]]\n      },\n    },\n\n    // :: NodeSpec The text node.\n    text: {\n      group: 'inline',\n    },\n\n    // :: NodeSpec An inline image (`<img>`) node. Supports `src`,\n    // `alt`, and `href` attributes. The latter two default to the empty\n    // string.\n    image: {\n      inline: true,\n      attrs: {\n        src: {},\n        alt: { default: null },\n        title: { default: null },\n      },\n      group: 'inline',\n      draggable: true,\n      parseDOM: [\n        {\n          tag: 'img[src]',\n          getAttrs(p) {\n            const dom = p as HTMLElement\n            return {\n              src: dom.getAttribute('src'),\n              title: dom.getAttribute('title'),\n              alt: dom.getAttribute('alt'),\n            }\n          },\n        },\n      ],\n      toDOM(node) {\n        const { src, alt, title } = node.attrs\n        return ['img', { src, alt, title }]\n      },\n    },\n\n    // :: NodeSpec A hard line break, represented in the DOM as `<br>`.\n    hard_break: {\n      inline: true,\n      group: 'inline',\n      selectable: false,\n      parseDOM: [{ tag: 'br' }],\n      toDOM() {\n        return ['br']\n      },\n    },\n  },\n  marks: {\n    // :: MarkSpec A link. Has `href` and `title` attributes. `title`\n    // defaults to the empty string. Rendered and parsed as an `<a>`\n    // element.\n    link: {\n      attrs: {\n        href: {},\n        title: { default: null },\n      },\n      inclusive: false,\n      parseDOM: [\n        {\n          tag: 'a[href]',\n          getAttrs(p) {\n            const dom = p as HTMLElement\n            return {\n              href: dom.getAttribute('href'),\n              title: dom.getAttribute('title'),\n            }\n          },\n        },\n      ],\n      toDOM(node) {\n        const { href, title } = node.attrs\n        return ['a', { href, title }, 0]\n      },\n    },\n\n    // :: MarkSpec An emphasis mark. Rendered as an `<em>` element.\n    // Has parse rules that also match `<i>` and `font-style: italic`.\n    italic: {\n      parseDOM: [{ tag: 'i' }, { tag: 'em' }, { style: 'font-style=italic' }],\n      toDOM() {\n        return ['em', 0]\n      },\n    },\n\n    // :: MarkSpec A strong mark. Rendered as `<strong>`, parse rules\n    // also match `<b>` and `font-weight: bold`.\n    bold: {\n      parseDOM: [\n        { tag: 'strong' },\n        // This works around a Google Docs misbehavior where\n        // pasted content will be inexplicably wrapped in `<b>`\n        // tags with a font-weight normal.\n        {\n          tag: 'b',\n          getAttrs: (p) => {\n            const node = p as HTMLElement\n            return node.style.fontWeight != 'normal' && null\n          },\n        },\n        {\n          style: 'font-weight',\n          getAttrs: (p) => {\n            const value = p as string\n            return /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null\n          },\n        },\n      ],\n      toDOM() {\n        return ['strong', 0]\n      },\n    },\n\n    // :: MarkSpec Code font mark. Represented as a `<code>` element.\n    code: {\n      parseDOM: [{ tag: 'code' }],\n      toDOM() {\n        return ['code', 0]\n      },\n    },\n\n    strikethrough: {\n      parseDOM: [\n        { tag: 's' },\n        { tag: 'strike' },\n        { style: 'text-decoration=line-through' },\n        { style: 'text-decoration-line=line-through' },\n      ],\n      toDOM: () => ['s'],\n    }\n  },\n})\n","import { EditorView } from 'prosemirror-view'\nimport { EditorState, Plugin, PluginKey, Transaction } from 'prosemirror-state'\nimport { Decoration, DecorationSet } from 'prosemirror-view'\nimport { ChangeSet, Span } from 'prosemirror-changeset'\nimport { ReplaceStep } from 'prosemirror-transform'\n\nimport { ExampleSchema, schema } from './schema'\n\nimport './track-changes.css'\n\nexport interface PluginState {\n  changeSet: ChangeSet\n  decorationSet: DecorationSet<ExampleSchema>\n}\n\nexport const trackChangesPluginKey = new PluginKey<PluginState, ExampleSchema>('track-changes')\n\nconst deletedWidget = (content: string) => (view: EditorView, getPos: () => number) => {\n  const element = document.createElement('span')\n  element.textContent = content\n  element.classList.add('deleted')\n  return element\n}\n\n/**\n * Not in use anymore as the content is now derived from doc (which makes joinChanges possible)\n * @param tr \n * @param oldState \n * @returns \n */\nfunction spanData(tr: Transaction, oldState: EditorState) {\n  return tr.steps.map(s => {\n    if (s instanceof ReplaceStep) {\n      // @ts-ignore\n      const noContent = s.slice.size === 0\n      if (noContent) {\n        // @ts-ignore\n        return oldState.doc.textBetween(s.from, s.to)\n      }\n      // @ts-ignore\n      return s.slice.content.textBetween(0, s.slice.size)\n    }\n  })\n}\n\n/**\n * Combines changes into one change, basically needed for deletions only since they behave weirdly\n * when the deletions are adjacent (probably a thing with adjacent decorations rather)\n * @param changes \n * @returns \n */\nconst joinChanges = (changes: Span[]) => changes.reduce((acc, cur, idx) => {\n  if (idx === 0) return [cur]\n  return Span.join([cur], acc, (a: any, b: any) => {\n    // Should combine the metadatas, usernames and timestamps et cetera\n    return b + a\n  })\n}, [] as Span[])\n\nexport const trackChangesPlugin = () =>\n  new Plugin({\n    key: trackChangesPluginKey,\n    state: {\n      init(config, state) {\n        return {\n          changeSet: ChangeSet.create(state.doc),\n          decorationSet: DecorationSet.empty,\n        }\n      },\n\n      apply(tr, value, oldState, newState) {\n        const changeSet = value.changeSet.addSteps(tr.doc, tr.mapping.maps, spanData(tr, oldState))\n        const decorations: Decoration[] = []\n        let allDeletionsLength = 0\n        let allInsertsLength = 0\n\n        changeSet.changes.forEach((change) => {\n          let insertFrom = change.fromB\n          change.inserted.forEach((span) => {\n            decorations.push(Decoration.inline(insertFrom, change.toB, { class: 'inserted' }))\n            // @ts-ignore\n            insertFrom += span.length\n            // @ts-ignore\n            allInsertsLength += span.length\n          })\n\n          joinChanges(change.deleted).forEach((span) => {\n            // @ts-ignore\n            const content = changeSet.startDoc.textBetween(change.fromA, change.fromA + span.length)\n            decorations.push(\n              Decoration.widget(change.fromA + allDeletionsLength + allInsertsLength, deletedWidget(content), {\n                side: -1,\n                marks: [schema.marks.strikethrough.create()],\n              })\n            )\n            // @ts-ignore\n            allDeletionsLength -= span.length\n          })\n        })\n\n        return {\n          changeSet,\n          decorationSet: DecorationSet.create(tr.doc, decorations)\n        }\n      },\n    },\n    props: {\n      decorations(state) {\n        return this.getState(state).decorationSet\n      },\n    },\n  })\n\n","import React, { useLayoutEffect, useRef } from 'react'\nimport { EditorView } from 'prosemirror-view'\nimport { EditorState, Transaction } from 'prosemirror-state'\nimport { exampleSetup } from 'prosemirror-example-setup'\n\nimport { schema } from './schema'\nimport { trackChangesPlugin } from './track-changes'\n\nimport './editor.css'\nimport './prosemirror-example-setup.css'\nimport './menu.css'\n\ninterface EditorProps {\n  className?: string\n  onEditorReady?: (view: EditorView) => void\n  onEdit?: (state: EditorState) => void\n}\n\nexport function PMEditor(props: EditorProps) {\n  const { className = '' } = props\n  const editorViewRef = useRef(null)\n  const editorRef = useRef<EditorView | null>(null)\n\n  useLayoutEffect(() => {\n    const state = createEditorState()\n    const editorViewDOM = editorViewRef.current\n    if (editorViewDOM) {\n      editorRef.current = createEditorView(editorViewDOM, state)\n      props.onEditorReady && props?.onEditorReady(editorRef.current)\n    }\n    return () => {\n      editorRef.current?.destroy()\n    }\n  }, [])\n\n  function createEditorState() {\n    return EditorState.create({\n      schema,\n      plugins: exampleSetup({ schema }).concat(trackChangesPlugin()),\n    })\n  }\n\n  function createEditorView(element: HTMLDivElement, state: EditorState) {\n    const view = new EditorView({ mount: element }, {\n      state,\n      dispatchTransaction,\n    })\n    // @ts-ignore\n    if (window) window.editorView = view\n    return view\n  }\n\n  function dispatchTransaction(transaction: Transaction) {\n    if (!editorRef.current) {\n      return\n    }\n    const editorState = editorRef.current.state.apply(transaction)\n    editorRef.current.updateState(editorState)\n    if (props.onEdit) {\n      props.onEdit(editorState)\n    }\n  }\n\n  return (\n    <div id=\"example-editor\" ref={editorViewRef} className={className}/>\n  )\n}\n","import { EditorView } from 'prosemirror-view'\nimport { EditorState } from 'prosemirror-state'\n\nexport class EditorStore {\n\n  view?: EditorView\n  currentEditorState?: {[key: string]: any}\n  localStorageKey: string\n\n  constructor(key: string) {\n    this.localStorageKey = key\n    if (typeof window !== 'undefined') {\n      const existing = localStorage.getItem(this.localStorageKey)\n      if (existing && existing !== null && existing.length > 0) {\n        let stored = JSON.parse(existing)\n        this.currentEditorState = stored\n      }\n    }\n  }\n\n  setEditorView = (view: EditorView) => {\n    this.view = view\n    if (this.currentEditorState) {\n      const state = EditorState.fromJSON(\n        {\n          schema: this.view.state.schema,\n          plugins: this.view.state.plugins,\n        },\n        this.currentEditorState\n      )\n      this.view.updateState(state)\n    }\n  }\n\n  syncCurrentEditorState = () => {\n    const newState = this.view!.state.toJSON()\n    localStorage.setItem(this.localStorageKey, JSON.stringify(newState))\n  }\n}","import React, { useMemo } from 'react'\nimport debounce from 'lodash.debounce'\n\nimport { EditorView } from 'prosemirror-view'\nimport { applyDevTools } from 'prosemirror-dev-tools'\n\nimport { PMEditor } from 'pm/PMEditor'\nimport { EditorStore } from './EditorStore'\n\nexport function Editor() {\n  const editorStore = useMemo(() => new EditorStore('track-changes'), [])\n  const debouncedSync = useMemo(() => debounce(editorStore.syncCurrentEditorState, 250), [])\n\n  function handleEdit() {\n    debouncedSync()\n  }\n  function handleEditorReady(view: EditorView) {\n    editorStore.setEditorView(view)\n    applyDevTools(view)\n  }\n  return (\n    <PMEditor\n      onEdit={handleEdit}\n      onEditorReady={handleEditorReady}\n    />\n  )\n}","import React from 'react'\nimport styled from 'styled-components'\n\nimport { PageHeader } from '../components/PageHeader'\nimport { Editor } from '../components/Editor'\n\nexport function FrontPage() {\n  return (\n    <Container>\n      <PageHeader/>\n      <Editor/>\n    </Container>\n  )\n}\n\nconst Container = styled.div``\n","import * as React from 'react'\nimport { BrowserRouter, Redirect, Switch } from 'react-router-dom'\n\nimport { WrappedRoute } from './components/WrappedRoute'\n\nimport { FrontPage } from './pages/FrontPage'\n\nexport const Routes = () => (\n  <BrowserRouter basename={process.env.PUBLIC_URL}>\n    <Switch>\n      <WrappedRoute exact path=\"/\" component={FrontPage}/>\n      <Redirect to=\"/\" />\n    </Switch>\n  </BrowserRouter>\n)\n","import * as React from 'react'\nimport { render } from 'react-dom'\n\nimport { Routes } from './routes'\n\nimport './index.css'\n\nrender(\n  <Routes />,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}